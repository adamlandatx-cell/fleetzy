<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fleetzy Admin</title>
    <link rel="stylesheet" href="css/charges.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="assets/favicon.png">
    <link rel="apple-touch-icon" href="assets/favicon.png">
    
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Dashboard Styles -->
    <link rel="stylesheet" href="css/dashboard.css">
</head>
<body>
    <!-- Mobile Header (visible on small screens) -->
    <header class="mobile-header">
        <div class="mobile-logo">
            <img src="assets/fleetzy-logo.png" alt="Fleetzy">
        </div>
        <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
            <i class="fas fa-bars"></i>
        </button>
    </header>

    <!-- Ambient Background Glow -->
    <div class="ambient-glow"></div>

    <!-- ============================================
         FLOATING SIDEBAR
    ============================================ -->
    <nav class="sidebar">
        <div class="sidebar-logo">
            <img src="assets/fleetzy-logo.png" alt="Fleetzy" class="logo-image">
        </div>
        
        <div class="sidebar-nav">
            <div class="nav-item active" data-section="dashboard">
                <i class="fas fa-th-large"></i>
                <span>Dashboard</span>
            </div>
            <div class="nav-item" data-section="vehicles">
                <i class="fas fa-car"></i>
                <span>Vehicles</span>
            </div>
            <div class="nav-item" data-section="customers">
                <i class="fas fa-users"></i>
                <span>Customers</span>
                <span class="badge" style="display: none;">0</span>
            </div>
            <div class="nav-item" data-section="rentals">
                <i class="fas fa-file-contract"></i>
                <span>Rentals</span>
                <span class="badge" id="rentals-badge" style="display: none;">0</span>
            </div>
            <div class="nav-item" data-section="payments">
                <i class="fas fa-credit-card"></i>
                <span>Payments</span>
                <span class="badge" id="payments-badge" style="display: none;">0</span>
            </div>
            
            <div class="nav-divider"></div>
            
            <div class="nav-item" data-section="reports">
                <i class="fas fa-chart-line"></i>
                <span>Reports</span>
            </div>
            <div class="nav-item" data-section="settings">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </div>
        </div>
    </nav>

    <!-- ============================================
         MAIN CONTENT
    ============================================ -->
    <main class="main-content">
        
        <!-- Top Bar -->
        <header class="top-bar">
            <div class="page-header">
                <h1 class="page-title">Dashboard</h1>
                <p class="page-subtitle">Welcome back, Adam. Here's what's happening today.</p>
            </div>
            
            <div class="top-actions">
                <!-- Search -->
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search anything..." id="global-search">
                    <kbd>âŒ˜K</kbd>
                </div>
                
                <!-- Theme Toggle -->
                <button class="icon-btn" onclick="Theme.toggle()" title="Toggle theme">
                    <i class="fas fa-moon" id="theme-icon"></i>
                </button>
                
                <!-- Notifications -->
                <button class="icon-btn" onclick="toggleNotifications()" title="Notifications">
                    <i class="fas fa-bell"></i>
                    <span class="badge"></span>
                </button>
                
                <!-- Profile -->
                <div class="profile-btn" onclick="toggleProfileMenu()">
                    <img src="https://ui-avatars.com/api/?name=Adam&background=10b981&color=fff&size=64" alt="Adam">
                    <div class="profile-info">
                        <div class="profile-name">Adam</div>
                        <div class="profile-role">Owner</div>
                    </div>
                </div>
            </div>
        </header>

        <!-- ============================================
             DASHBOARD SECTION
        ============================================ -->
        <section id="section-dashboard" class="content-section active">
            
            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card" style="opacity: 0;">
                    <div class="stat-header">
                        <span class="stat-label">Monthly Revenue</span>
                        <div class="stat-icon green">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                    </div>
                    <div class="stat-value gradient" id="stat-revenue">$0</div>
                    <span class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        vs last month
                    </span>
                </div>
                
                <div class="stat-card" style="opacity: 0;">
                    <div class="stat-header">
                        <span class="stat-label">Active Rentals</span>
                        <div class="stat-icon blue">
                            <i class="fas fa-key"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="stat-rentals">0</div>
                    <span class="stat-change neutral">
                        <i class="fas fa-minus"></i>
                        Current
                    </span>
                </div>
                
                <div class="stat-card" style="opacity: 0;">
                    <div class="stat-header">
                        <span class="stat-label">Fleet Utilization</span>
                        <div class="stat-icon amber">
                            <i class="fas fa-percentage"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="stat-utilization">0%</div>
                    <span class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        Target: 80%
                    </span>
                </div>
                
                <div class="stat-card stat-card-clickable" style="opacity: 0;" onclick="Dashboard.openPendingActionsModal()" title="Click to view pending actions">
                    <div class="stat-header">
                        <span class="stat-label">Pending Actions</span>
                        <div class="stat-icon purple">
                            <i class="fas fa-clock"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="stat-pending">0</div>
                    <span class="stat-change negative" id="pending-change">
                        <i class="fas fa-exclamation"></i>
                        Need attention
                    </span>
                </div>
            </div>

            <!-- Dashboard Grid -->
            <div class="dashboard-grid">
                
                <!-- Left Column -->
                <div class="dashboard-column">
                    
                    <!-- Revenue Chart -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-chart-area"></i>
                                Revenue Overview
                            </h2>
                            <div class="card-actions">
                                <button class="btn btn-ghost">Week</button>
                                <button class="btn btn-ghost active">Month</button>
                                <button class="btn btn-ghost">Year</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <div class="chart-bars" id="revenue-chart">
                                    <!-- Chart bars populated by JS or static for now -->
                                    <div class="chart-bar-wrapper">
                                        <div class="chart-bar" style="height: 45%;" data-height="45%" data-value="$2,400"></div>
                                        <span class="chart-label">Jan</span>
                                    </div>
                                    <div class="chart-bar-wrapper">
                                        <div class="chart-bar" style="height: 60%;" data-height="60%" data-value="$3,200"></div>
                                        <span class="chart-label">Feb</span>
                                    </div>
                                    <div class="chart-bar-wrapper">
                                        <div class="chart-bar" style="height: 55%;" data-height="55%" data-value="$2,900"></div>
                                        <span class="chart-label">Mar</span>
                                    </div>
                                    <div class="chart-bar-wrapper">
                                        <div class="chart-bar" style="height: 70%;" data-height="70%" data-value="$3,800"></div>
                                        <span class="chart-label">Apr</span>
                                    </div>
                                    <div class="chart-bar-wrapper">
                                        <div class="chart-bar" style="height: 80%;" data-height="80%" data-value="$4,200"></div>
                                        <span class="chart-label">May</span>
                                    </div>
                                    <div class="chart-bar-wrapper">
                                        <div class="chart-bar" style="height: 65%;" data-height="65%" data-value="$3,500"></div>
                                        <span class="chart-label">Jun</span>
                                    </div>
                                    <div class="chart-bar-wrapper">
                                        <div class="chart-bar" style="height: 90%;" data-height="90%" data-value="$4,800"></div>
                                        <span class="chart-label">Jul</span>
                                    </div>
                                    <div class="chart-bar-wrapper">
                                        <div class="chart-bar" style="height: 85%;" data-height="85%" data-value="$4,500"></div>
                                        <span class="chart-label">Aug</span>
                                    </div>
                                    <div class="chart-bar-wrapper">
                                        <div class="chart-bar" style="height: 75%;" data-height="75%" data-value="$4,000"></div>
                                        <span class="chart-label">Sep</span>
                                    </div>
                                    <div class="chart-bar-wrapper">
                                        <div class="chart-bar" style="height: 95%;" data-height="95%" data-value="$5,100"></div>
                                        <span class="chart-label">Oct</span>
                                    </div>
                                    <div class="chart-bar-wrapper">
                                        <div class="chart-bar" style="height: 88%;" data-height="88%" data-value="$4,700"></div>
                                        <span class="chart-label">Nov</span>
                                    </div>
                                    <div class="chart-bar-wrapper">
                                        <div class="chart-bar" style="height: 100%;" data-height="100%" data-value="$5,400"></div>
                                        <span class="chart-label">Dec</span>
                                    </div>
                                </div>
                                <div class="chart-legend">
                                    <div class="legend-item">
                                        <span class="legend-dot" style="background: var(--accent-green);"></span>
                                        Revenue
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-dot" style="background: var(--accent-blue);"></span>
                                        Expenses
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Fleet Overview -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-car-side"></i>
                                Fleet Status
                            </h2>
                            <div class="card-actions">
                                <button class="btn btn-primary" onclick="Vehicles.openAddModal()">
                                    <i class="fas fa-plus"></i>
                                    Add Vehicle
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="fleet-grid" id="fleet-grid">
                                <!-- Populated by JavaScript -->
                                <div style="grid-column: span 2; text-align: center; padding: 40px; color: var(--text-tertiary);">
                                    <i class="fas fa-spinner fa-spin" style="font-size: 24px;"></i>
                                    <p style="margin-top: 12px;">Loading fleet...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="dashboard-column">
                    <!-- ============================================
     UPCOMING PAYMENTS WIDGET
     Add this in your dashboard section, 
     ideally in the right column or after the stats cards
     ============================================ -->

<!-- Upcoming Payments Widget -->
<div class="card upcoming-payments-card">
    <div class="upcoming-payments-header">
        <div class="upcoming-payments-title">
            <i class="fas fa-calendar-check"></i>
            <span>Upcoming Payments</span>
        </div>
        <div class="upcoming-mini-stats">
            <div class="upcoming-mini-stat">
                <div class="upcoming-mini-stat-value" id="stat-expected-week">$0</div>
                <div class="upcoming-mini-stat-label">This Week</div>
            </div>
            <div class="upcoming-mini-stat">
                <div class="upcoming-mini-stat-value warning" id="stat-due-tomorrow">0</div>
                <div class="upcoming-mini-stat-label">Due Tomorrow</div>
            </div>
        </div>
    </div>
    <div class="card-body" style="padding: 0; max-height: 400px; overflow-y: auto;">
        <div id="upcoming-payments-list">
            <!-- Populated by JavaScript -->
            <div class="upcoming-empty">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading payments...</p>
            </div>
        </div>
    </div>
    <div class="card-footer" style="padding: 12px 20px; border-top: 1px solid var(--border-primary); display: flex; justify-content: space-between; align-items: center;">
        <button class="btn btn-ghost btn-sm" onclick="Sidebar.navigate('payments')">
            View All <i class="fas fa-arrow-right"></i>
        </button>
        <button class="btn btn-primary btn-sm" onclick="Charges.openAddChargeModal()">
            <i class="fas fa-plus"></i> Add Charge
        </button>
    </div>
</div>                    
                    <!-- AI Insights -->
                    <div class="card ai-insights">
                        <div class="card-header">
                            <div class="ai-header">
                                <h2 class="card-title" style="margin: 0;">
                                    <i class="fas fa-brain"></i>
                                    AI Insights
                                </h2>
                                <span class="ai-badge">
                                    <i class="fas fa-sparkles"></i>
                                    SMART
                                </span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="insight-list" id="ai-insights-list">
                                <!-- Populated by JavaScript -->
                                <div class="insight-item">
                                    <div class="insight-icon warning">
                                        <i class="fas fa-wrench"></i>
                                    </div>
                                    <div class="insight-content">
                                        <div class="insight-title">Maintenance Predicted</div>
                                        <div class="insight-desc">Vehicle service predictions based on mileage and driving patterns.</div>
                                        <div class="insight-action">
                                            Schedule now <i class="fas fa-arrow-right"></i>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="insight-item">
                                    <div class="insight-icon success">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <div class="insight-content">
                                        <div class="insight-title">Revenue Forecast</div>
                                        <div class="insight-desc">Projected monthly revenue based on current bookings.</div>
                                        <div class="insight-action">
                                            View details <i class="fas fa-arrow-right"></i>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="insight-item">
                                    <div class="insight-icon info">
                                        <i class="fas fa-lightbulb"></i>
                                    </div>
                                    <div class="insight-content">
                                        <div class="insight-title">Optimization Tip</div>
                                        <div class="insight-desc">Fleet utilization insights and growth recommendations.</div>
                                        <div class="insight-action">
                                            Learn more <i class="fas fa-arrow-right"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Activity Feed -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-stream"></i>
                                Recent Activity
                            </h2>
                            <button class="btn btn-ghost">View All</button>
                        </div>
                        <div class="card-body" style="padding: 16px 24px;">
                            <div class="activity-list" id="activity-feed">
                                <!-- Populated by JavaScript -->
                                <div class="activity-item">
                                    <div class="activity-icon payment">
                                        <i class="fas fa-dollar-sign"></i>
                                    </div>
                                    <div class="activity-content">
                                        <div class="activity-text">
                                            Loading recent activity...
                                        </div>
                                        <div class="activity-time">--</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ============================================
             VEHICLES SECTION
        ============================================ -->
        <section id="section-vehicles" class="content-section" style="display: none;">
            
            <!-- Vehicles Header -->
            <div class="section-header">
                <div class="section-header-left">
                    <h2>Fleet Management</h2>
                    <p>Manage your vehicle inventory</p>
                </div>
                <div class="section-header-right">
                    <button class="btn btn-secondary" onclick="Vehicles.refresh()">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                    <button class="btn btn-primary" onclick="Vehicles.openAddModal()">
                        <i class="fas fa-plus"></i>
                        Add Vehicle
                    </button>
                </div>
            </div>
            
            <!-- Vehicles Stats -->
            <div class="mini-stats-grid">
                <div class="mini-stat">
                    <div class="mini-stat-icon blue">
                        <i class="fas fa-car"></i>
                    </div>
                    <div class="mini-stat-content">
                        <div class="mini-stat-value" id="vehicles-stat-total">0</div>
                        <div class="mini-stat-label">Total Vehicles</div>
                    </div>
                </div>
                <div class="mini-stat">
                    <div class="mini-stat-icon green">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="mini-stat-content">
                        <div class="mini-stat-value" id="vehicles-stat-available">0</div>
                        <div class="mini-stat-label">Available</div>
                    </div>
                </div>
                <div class="mini-stat">
                    <div class="mini-stat-icon amber">
                        <i class="fas fa-key"></i>
                    </div>
                    <div class="mini-stat-content">
                        <div class="mini-stat-value" id="vehicles-stat-rented">0</div>
                        <div class="mini-stat-label">Rented</div>
                    </div>
                </div>
                <div class="mini-stat">
                    <div class="mini-stat-icon red">
                        <i class="fas fa-wrench"></i>
                    </div>
                    <div class="mini-stat-content">
                        <div class="mini-stat-value" id="vehicles-stat-maintenance">0</div>
                        <div class="mini-stat-label">In Service</div>
                    </div>
                </div>
            </div>
            
            <!-- Vehicles Table Card -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-list"></i>
                        All Vehicles
                    </h2>
                    <div class="card-filters">
                        <div class="search-input">
                            <i class="fas fa-search"></i>
                            <input type="text" id="vehicles-search" placeholder="Search vehicles..." oninput="Vehicles.filter()">
                        </div>
                        <select id="vehicles-status-filter" class="filter-select" onchange="Vehicles.filter()">
                            <option value="">All Statuses</option>
                            <option value="Available">Available</option>
                            <option value="Rented">Rented</option>
                            <option value="Maintenance">Maintenance</option>
                            <option value="Reserved">Reserved</option>
                        </select>
                    </div>
                </div>
                <div class="card-body no-padding">
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Vehicle</th>
                                    <th>Plate</th>
                                    <th>Status</th>
                                    <th>Mileage</th>
                                    <th>Rate</th>
                                    <th>VIN</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="vehicles-table-body">
                                <tr>
                                    <td colspan="7" class="loading-state">
                                        <i class="fas fa-spinner fa-spin"></i>
                                        <p>Loading vehicles...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- ============================================
             ADD VEHICLE MODAL
        ============================================ -->
        <div class="modal" id="modal-add-vehicle">
            <div class="modal-backdrop" onclick="Vehicles.closeAddModal()"></div>
            <div class="modal-content modal-lg">
                <div class="modal-header">
                    <h3><i class="fas fa-car"></i> Add New Vehicle</h3>
                    <button class="modal-close" onclick="Vehicles.closeAddModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="form-add-vehicle" onsubmit="event.preventDefault(); Vehicles.save();">
                    <div class="modal-body">
                        <div class="form-grid">
                            <!-- Vehicle ID -->
                            <div class="form-group">
                                <label for="add-vehicle-id">Vehicle ID</label>
                                <input type="text" id="add-vehicle-id" name="vehicle_id" readonly class="readonly">
                            </div>
                            
                            <!-- Make -->
                            <div class="form-group">
                                <label for="add-vehicle-make">Make <span class="required">*</span></label>
                                <input type="text" id="add-vehicle-make" name="make" required placeholder="e.g., Toyota">
                            </div>
                            
                            <!-- Model -->
                            <div class="form-group">
                                <label for="add-vehicle-model">Model <span class="required">*</span></label>
                                <input type="text" id="add-vehicle-model" name="model" required placeholder="e.g., Camry">
                            </div>
                            
                            <!-- Year -->
                            <div class="form-group">
                                <label for="add-vehicle-year">Year</label>
                                <input type="number" id="add-vehicle-year" name="year" min="2000" max="2030" placeholder="e.g., 2020">
                            </div>
                            
                            <!-- VIN -->
                            <div class="form-group">
                                <label for="add-vehicle-vin">VIN</label>
                                <input type="text" id="add-vehicle-vin" name="vin" maxlength="17" placeholder="17-character VIN">
                            </div>
                            
                            <!-- License Plate -->
                            <div class="form-group">
                                <label for="add-vehicle-license-plate">License Plate</label>
                                <input type="text" id="add-vehicle-license-plate" name="license_plate" placeholder="e.g., ABC-1234">
                            </div>
                            
                            <!-- Color -->
                            <div class="form-group">
                                <label for="add-vehicle-color">Color</label>
                                <input type="text" id="add-vehicle-color" name="color" placeholder="e.g., Silver">
                            </div>
                            
                            <!-- Status -->
                            <div class="form-group">
                                <label for="add-vehicle-status">Status</label>
                                <select id="add-vehicle-status" name="vehicle_status">
                                    <option value="Available" selected>Available</option>
                                    <option value="Rented">Rented</option>
                                    <option value="Maintenance">Maintenance</option>
                                    <option value="Reserved">Reserved</option>
                                </select>
                            </div>
                            
                            <!-- Weekly Rate -->
                            <div class="form-group">
                                <label for="add-vehicle-weekly-rate">Weekly Rate ($)</label>
                                <input type="number" id="add-vehicle-weekly-rate" name="weekly_rate" value="400" min="0" step="25">
                            </div>
                            
                            <!-- Current Mileage -->
                            <div class="form-group">
                                <label for="add-vehicle-mileage">Current Mileage</label>
                                <input type="number" id="add-vehicle-mileage" name="current_mileage" value="0" min="0">
                            </div>
                            
                            <!-- Purchase Price -->
                            <div class="form-group">
                                <label for="add-vehicle-purchase-price">Purchase Price ($)</label>
                                <input type="number" id="add-vehicle-purchase-price" name="purchase_price" min="0" step="100" placeholder="e.g., 15000">
                            </div>
                            
                            <!-- Monthly Payment -->
                            <div class="form-group">
                                <label for="add-vehicle-monthly-payment">Monthly Payment ($)</label>
                                <input type="number" id="add-vehicle-monthly-payment" name="monthly_payment" min="0" step="10" placeholder="e.g., 350">
                            </div>
                            
                            <!-- Insurance Cost -->
                            <div class="form-group">
                                <label for="add-vehicle-insurance">Insurance Cost ($/mo)</label>
                                <input type="number" id="add-vehicle-insurance" name="insurance_cost" min="0" step="10" placeholder="e.g., 150">
                            </div>
                            
                            <!-- GPS Device ID -->
                            <div class="form-group">
                                <label for="add-vehicle-gps">GPS Device ID</label>
                                <input type="text" id="add-vehicle-gps" name="gps_device_id" placeholder="Spy Spot device ID">
                            </div>
                            
                            <!-- Vehicle Image -->
                            <div class="form-group full-width">
                                <label for="add-vehicle-image">Vehicle Photo</label>
                                <input type="file" id="add-vehicle-image" name="image" accept="image/*">
                            </div>
                            
                            <!-- Notes -->
                            <div class="form-group full-width">
                                <label for="add-vehicle-notes">Notes</label>
                                <textarea id="add-vehicle-notes" name="notes" rows="3" placeholder="Any additional notes..."></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="Vehicles.closeAddModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save Vehicle
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ============================================
             VIEW VEHICLE MODAL
        ============================================ -->
        <div class="modal vehicle-detail-modal" id="modal-view-vehicle">
            <div class="modal-backdrop" onclick="Vehicles.closeViewModal()"></div>
            <div class="modal-content">
                <button class="modal-close" onclick="Vehicles.closeViewModal()" style="position: absolute; top: 16px; right: 16px; z-index: 10; background: rgba(0,0,0,0.5); color: white;">
                    <i class="fas fa-times"></i>
                </button>
                <div class="modal-body" style="padding: var(--space-lg);">
                    <div class="vehicle-detail-header" id="view-vehicle-image">
                        <!-- Image or placeholder populated by JS -->
                    </div>
                    
                    <h2 class="vehicle-detail-title" id="view-vehicle-title">2024 Toyota Camry</h2>
                    <div class="vehicle-detail-subtitle">
                        <span><i class="fas fa-hashtag"></i> <span id="view-vehicle-id">V-001</span></span>
                        <span><i class="fas fa-palette"></i> <span id="view-vehicle-color">Silver</span></span>
                    </div>
                    
                    <div class="vehicle-detail-grid">
                        <div class="vehicle-detail-item">
                            <label>License Plate</label>
                            <div class="value mono" id="view-vehicle-plate">ABC1234</div>
                        </div>
                        <div class="vehicle-detail-item">
                            <label>VIN</label>
                            <div class="value mono" id="view-vehicle-vin" style="font-size: 12px;">1HGBH41JXMN109186</div>
                        </div>
                        <div class="vehicle-detail-item">
                            <label>Current Mileage</label>
                            <div class="value" id="view-vehicle-mileage">45,230 mi</div>
                        </div>
                        <div class="vehicle-detail-item">
                            <label>Weekly Rate</label>
                            <div class="value highlight" id="view-vehicle-rate">$400/wk</div>
                        </div>
                        <div class="vehicle-detail-item">
                            <label>Status</label>
                            <div class="value" id="view-vehicle-status">Available</div>
                        </div>
                        <div class="vehicle-detail-item">
                            <label>Last Service</label>
                            <div class="value" id="view-vehicle-service">Oct 15, 2024</div>
                        </div>
                    </div>
                    
                    <div class="vehicle-detail-actions">
                        <button type="button" class="btn btn-secondary" onclick="Vehicles.closeViewModal()">
                            <i class="fas fa-times"></i> Close
                        </button>
                        <button type="button" class="btn btn-primary" onclick="Vehicles.closeViewModal(); Vehicles.edit(document.getElementById('view-vehicle-uuid').value);">
                            <i class="fas fa-edit"></i> Edit Vehicle
                        </button>
                    </div>
                    <input type="hidden" id="view-vehicle-uuid">
                </div>
            </div>
        </div>

        <!-- ============================================
             EDIT VEHICLE MODAL
        ============================================ -->
        <div class="modal" id="modal-edit-vehicle">
            <div class="modal-backdrop" onclick="Vehicles.closeEditModal()"></div>
            <div class="modal-content modal-lg">
                <div class="modal-header">
                    <h3><i class="fas fa-edit"></i> Edit Vehicle</h3>
                    <button class="modal-close" onclick="Vehicles.closeEditModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="form-edit-vehicle" onsubmit="event.preventDefault(); Vehicles.update();">
                    <input type="hidden" id="edit-vehicle-id">
                    <div class="modal-body">
                        <div class="form-grid">
                            <!-- Vehicle ID (readonly) -->
                            <div class="form-group">
                                <label for="edit-vehicle-display-id">Vehicle ID</label>
                                <input type="text" id="edit-vehicle-display-id" readonly class="readonly">
                            </div>
                            
                            <!-- Make -->
                            <div class="form-group">
                                <label for="edit-vehicle-make">Make <span class="required">*</span></label>
                                <input type="text" id="edit-vehicle-make" required>
                            </div>
                            
                            <!-- Model -->
                            <div class="form-group">
                                <label for="edit-vehicle-model">Model <span class="required">*</span></label>
                                <input type="text" id="edit-vehicle-model" required>
                            </div>
                            
                            <!-- Year -->
                            <div class="form-group">
                                <label for="edit-vehicle-year">Year</label>
                                <input type="number" id="edit-vehicle-year" min="2000" max="2030">
                            </div>
                            
                            <!-- VIN -->
                            <div class="form-group">
                                <label for="edit-vehicle-vin">VIN</label>
                                <input type="text" id="edit-vehicle-vin" maxlength="17">
                            </div>
                            
                            <!-- License Plate -->
                            <div class="form-group">
                                <label for="edit-vehicle-license-plate">License Plate</label>
                                <input type="text" id="edit-vehicle-license-plate">
                            </div>
                            
                            <!-- Color -->
                            <div class="form-group">
                                <label for="edit-vehicle-color">Color</label>
                                <input type="text" id="edit-vehicle-color">
                            </div>
                            
                            <!-- Status -->
                            <div class="form-group">
                                <label for="edit-vehicle-status">Status</label>
                                <select id="edit-vehicle-status">
                                    <option value="Available">Available</option>
                                    <option value="Rented">Rented</option>
                                    <option value="Maintenance">Maintenance</option>
                                    <option value="Reserved">Reserved</option>
                                </select>
                            </div>
                            
                            <!-- Weekly Rate -->
                            <div class="form-group">
                                <label for="edit-vehicle-weekly-rate">Weekly Rate ($)</label>
                                <input type="number" id="edit-vehicle-weekly-rate" min="0" step="25">
                            </div>
                            
                            <!-- Current Mileage -->
                            <div class="form-group">
                                <label for="edit-vehicle-mileage">Current Mileage</label>
                                <input type="number" id="edit-vehicle-mileage" min="0">
                            </div>
                            
                            <!-- Purchase Price -->
                            <div class="form-group">
                                <label for="edit-vehicle-purchase-price">Purchase Price ($)</label>
                                <input type="number" id="edit-vehicle-purchase-price" min="0" step="100">
                            </div>
                            
                            <!-- Monthly Payment -->
                            <div class="form-group">
                                <label for="edit-vehicle-monthly-payment">Monthly Payment ($)</label>
                                <input type="number" id="edit-vehicle-monthly-payment" min="0" step="10">
                            </div>
                            
                            <!-- Insurance Cost -->
                            <div class="form-group">
                                <label for="edit-vehicle-insurance">Insurance Cost ($/mo)</label>
                                <input type="number" id="edit-vehicle-insurance" min="0" step="10">
                            </div>
                            
                            <!-- GPS Device ID -->
                            <div class="form-group">
                                <label for="edit-vehicle-gps">GPS Device ID</label>
                                <input type="text" id="edit-vehicle-gps">
                            </div>
                            
                            <!-- Notes -->
                            <div class="form-group full-width">
                                <label for="edit-vehicle-notes">Notes</label>
                                <textarea id="edit-vehicle-notes" rows="3"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="Vehicles.closeEditModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Update Vehicle
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ============================================
             CUSTOMERS SECTION
        ============================================ -->
        <section id="section-customers" class="content-section" style="display: none;">
            
            <!-- Customers Header -->
            <div class="section-header">
                <div class="section-header-left">
                    <h2>Customer Management</h2>
                    <p>Review applications, manage customer profiles</p>
                </div>
                <div class="section-header-right">
                    <button class="btn btn-secondary" onclick="Customers.refresh()">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                    <button class="btn btn-primary" onclick="Customers.openAddModal()">
                        <i class="fas fa-user-plus"></i>
                        Add Customer
                    </button>
                </div>
            </div>
            
            <!-- Customers Stats -->
            <div class="mini-stats-grid">
                <div class="mini-stat">
                    <div class="mini-stat-icon blue">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="mini-stat-content">
                        <div class="mini-stat-value" id="customers-stat-total">0</div>
                        <div class="mini-stat-label">Total Customers</div>
                    </div>
                </div>
                <div class="mini-stat highlight">
                    <div class="mini-stat-icon amber">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="mini-stat-content">
                        <div class="mini-stat-value" id="customers-stat-pending">0</div>
                        <div class="mini-stat-label">Pending Review</div>
                    </div>
                </div>
                <div class="mini-stat">
                    <div class="mini-stat-icon green">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="mini-stat-content">
                        <div class="mini-stat-value" id="customers-stat-approved">0</div>
                        <div class="mini-stat-label">Approved</div>
                    </div>
                </div>
                <div class="mini-stat">
                    <div class="mini-stat-icon purple">
                        <i class="fas fa-car"></i>
                    </div>
                    <div class="mini-stat-content">
                        <div class="mini-stat-value" id="customers-stat-active">0</div>
                        <div class="mini-stat-label">Active Renters</div>
                    </div>
                </div>
            </div>
            
            <!-- Customers Table Card -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-list"></i>
                        All Customers
                    </h2>
                    <div class="card-filters">
                        <div class="search-input">
                            <i class="fas fa-search"></i>
                            <input type="text" id="customers-search" placeholder="Search customers..." oninput="Customers.filter()">
                        </div>
                        <select id="customers-status-filter" class="filter-select" onchange="Customers.filter()">
                            <option value="">All Statuses</option>
                            <option value="pending">Pending Review</option>
                            <option value="approved">Approved</option>
                            <option value="rejected">Rejected</option>
                        </select>
                    </div>
                </div>
                <div class="card-body no-padding">
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Customer</th>
                                    <th>Contact</th>
                                    <th>Status</th>
                                    <th>Driver's License</th>
                                    <th>Applied</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="customers-table-body">
                                <tr>
                                    <td colspan="6" class="loading-state">
                                        <i class="fas fa-spinner fa-spin"></i>
                                        <p>Loading customers...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- ============================================
             REVIEW CUSTOMER MODAL
        ============================================ -->
        <div class="modal" id="modal-review-customer">
            <div class="modal-backdrop" onclick="Customers.closeReviewModal()"></div>
            <div class="modal-content modal-xl">
                <div class="modal-header">
                    <h3><i class="fas fa-clipboard-check"></i> Review Application</h3>
                    <button class="modal-close" onclick="Customers.closeReviewModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="review-grid">
                        <!-- Left Column: Info -->
                        <div class="review-info">
                            <div class="review-section">
                                <h4><i class="fas fa-user"></i> Personal Information</h4>
                                <div class="info-grid">
                                    <div class="info-item">
                                        <span class="info-label">Name</span>
                                        <span class="info-value" id="review-customer-name">-</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Customer ID</span>
                                        <span class="info-value" id="review-customer-id">-</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Phone</span>
                                        <span class="info-value" id="review-customer-phone">-</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Email</span>
                                        <span class="info-value" id="review-customer-email">-</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Date of Birth</span>
                                        <span class="info-value" id="review-customer-dob">-</span>
                                    </div>
                                    <div class="info-item full-width">
                                        <span class="info-label">Address</span>
                                        <span class="info-value" id="review-customer-address">-</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="review-section">
                                <h4><i class="fas fa-id-card"></i> Driver's License</h4>
                                <div class="info-grid">
                                    <div class="info-item">
                                        <span class="info-label">License Number</span>
                                        <span class="info-value" id="review-dl-number">-</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">State</span>
                                        <span class="info-value" id="review-dl-state">-</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Expiration</span>
                                        <span class="info-value" id="review-dl-expiry">-</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Background Check</span>
                                        <span class="status-badge status-unknown" id="review-bg-status">Not Started</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="review-section" id="review-corporate-section" style="display: none;">
                                <h4><i class="fas fa-building"></i> Corporate Information</h4>
                                <div class="info-grid">
                                    <div class="info-item">
                                        <span class="info-label">Company</span>
                                        <span class="info-value" id="review-company-name">-</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">HR Representative</span>
                                        <span class="info-value" id="review-company-rep">-</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Company Phone</span>
                                        <span class="info-value" id="review-company-phone">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Right Column: Documents -->
                        <div class="review-documents">
                            <h4><i class="fas fa-file-image"></i> Uploaded Documents</h4>
                            
                            <div class="doc-grid">
                                <div class="doc-item">
                                    <span class="doc-label">Driver's License (Front)</span>
                                    <div class="doc-preview" id="review-dl-front">
                                        <div class="doc-placeholder">
                                            <i class="fas fa-image"></i>
                                            <span>Loading...</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="doc-item">
                                    <span class="doc-label">Driver's License (Back)</span>
                                    <div class="doc-preview" id="review-dl-back">
                                        <div class="doc-placeholder">
                                            <i class="fas fa-image"></i>
                                            <span>Loading...</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="doc-item">
                                    <span class="doc-label">Selfie Photo</span>
                                    <div class="doc-preview" id="review-selfie">
                                        <div class="doc-placeholder">
                                            <i class="fas fa-image"></i>
                                            <span>Loading...</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="doc-item" id="review-income-section">
                                    <span class="doc-label">Income Proof</span>
                                    <div class="doc-preview" id="review-income-proof">
                                        <div class="doc-placeholder">
                                            <i class="fas fa-image"></i>
                                            <span>Loading...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" id="review-actions">
                    <button type="button" class="btn btn-secondary" onclick="Customers.closeReviewModal()">Close</button>
                    <button type="button" class="btn btn-danger" onclick="Customers.openRejectModal(document.getElementById('modal-review-customer').dataset.customerId)">
                        <i class="fas fa-times"></i> Reject
                    </button>
                    <button type="button" class="btn btn-primary" onclick="Customers.approve(document.getElementById('modal-review-customer').dataset.customerId, true)">
                        <i class="fas fa-check"></i> Approve
                    </button>
                </div>
            </div>
        </div>

        <!-- ============================================
             REJECT CUSTOMER MODAL
        ============================================ -->
        <div class="modal" id="modal-reject-customer">
            <div class="modal-backdrop" onclick="Customers.closeRejectModal()"></div>
            <div class="modal-content modal-sm">
                <div class="modal-header">
                    <h3><i class="fas fa-times-circle"></i> Reject Application</h3>
                    <button class="modal-close" onclick="Customers.closeRejectModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <p class="text-secondary" style="margin-bottom: 16px;">
                        Are you sure you want to reject <strong id="reject-customer-name"></strong>'s application?
                    </p>
                    <div class="form-group">
                        <label for="reject-reason">Reason for Rejection (optional)</label>
                        <textarea id="reject-reason" rows="3" placeholder="Enter reason..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="Customers.closeRejectModal()">Cancel</button>
                    <button type="button" class="btn btn-danger" onclick="Customers.confirmReject()">
                        <i class="fas fa-times"></i> Reject Application
                    </button>
                </div>
            </div>
        </div>

        <!-- ============================================
             ADD CUSTOMER MODAL
        ============================================ -->
        <div class="modal" id="modal-add-customer">
            <div class="modal-backdrop" onclick="Customers.closeAddModal()"></div>
            <div class="modal-content modal-xl">
                <div class="modal-header">
                    <h3><i class="fas fa-user-plus"></i> Add New Customer</h3>
                    <button class="modal-close" onclick="Customers.closeAddModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="form-add-customer" onsubmit="event.preventDefault(); Customers.create();">
                    <div class="modal-body">
                        <!-- Corporate Toggle -->
                        <div class="form-section">
                            <div class="toggle-group">
                                <label class="toggle-label">
                                    <input type="checkbox" id="add-customer-is-corporate" onchange="Customers.toggleCorporateFields()">
                                    <span class="toggle-switch"></span>
                                    <span class="toggle-text">Corporate Rental</span>
                                </label>
                            </div>
                        </div>

                        <!-- Personal Information -->
                        <div class="form-section">
                            <h4 class="section-title"><i class="fas fa-user"></i> Personal Information</h4>
                            <div class="form-grid">
                                <!-- Customer ID (auto-generated) -->
                                <div class="form-group">
                                    <label for="add-customer-id">Customer ID</label>
                                    <input type="text" id="add-customer-id" readonly class="readonly" placeholder="Auto-generated">
                                </div>
                                
                                <!-- First Name -->
                                <div class="form-group">
                                    <label for="add-customer-first-name">First Name <span class="required">*</span></label>
                                    <input type="text" id="add-customer-first-name" required placeholder="John">
                                </div>
                                
                                <!-- Last Name -->
                                <div class="form-group">
                                    <label for="add-customer-last-name">Last Name <span class="required">*</span></label>
                                    <input type="text" id="add-customer-last-name" required placeholder="Doe">
                                </div>
                                
                                <!-- Phone -->
                                <div class="form-group">
                                    <label for="add-customer-phone">Phone <span class="required">*</span></label>
                                    <input type="tel" id="add-customer-phone" required placeholder="(281) 555-1234">
                                </div>
                                
                                <!-- Email -->
                                <div class="form-group">
                                    <label for="add-customer-email">Email</label>
                                    <input type="email" id="add-customer-email" placeholder="john@example.com">
                                </div>
                                
                                <!-- Date of Birth -->
                                <div class="form-group">
                                    <label for="add-customer-dob">Date of Birth</label>
                                    <input type="date" id="add-customer-dob">
                                </div>
                            </div>
                        </div>

                        <!-- Address -->
                        <div class="form-section">
                            <h4 class="section-title"><i class="fas fa-map-marker-alt"></i> Address</h4>
                            <div class="form-grid">
                                <!-- Street -->
                                <div class="form-group full-width">
                                    <label for="add-customer-address">Street Address</label>
                                    <input type="text" id="add-customer-address" placeholder="123 Main Street">
                                </div>
                                
                                <!-- City -->
                                <div class="form-group">
                                    <label for="add-customer-city">City</label>
                                    <input type="text" id="add-customer-city" placeholder="Houston">
                                </div>
                                
                                <!-- State -->
                                <div class="form-group">
                                    <label for="add-customer-state">State</label>
                                    <select id="add-customer-state">
                                        <option value="">Select State</option>
                                        <option value="TX" selected>Texas</option>
                                        <option value="LA">Louisiana</option>
                                        <option value="OK">Oklahoma</option>
                                        <option value="AR">Arkansas</option>
                                        <option value="NM">New Mexico</option>
                                    </select>
                                </div>
                                
                                <!-- ZIP -->
                                <div class="form-group">
                                    <label for="add-customer-zip">ZIP Code</label>
                                    <input type="text" id="add-customer-zip" placeholder="77001" maxlength="10">
                                </div>
                            </div>
                        </div>

                        <!-- Driver's License -->
                        <div class="form-section">
                            <h4 class="section-title"><i class="fas fa-id-card"></i> Driver's License</h4>
                            <div class="form-grid">
                                <!-- DL Number -->
                                <div class="form-group">
                                    <label for="add-customer-dl-number">License Number <span class="required">*</span></label>
                                    <input type="text" id="add-customer-dl-number" required placeholder="12345678">
                                </div>
                                
                                <!-- DL State -->
                                <div class="form-group">
                                    <label for="add-customer-dl-state">License State <span class="required">*</span></label>
                                    <select id="add-customer-dl-state" required>
                                        <option value="">Select State</option>
                                        <option value="TX" selected>Texas</option>
                                        <option value="LA">Louisiana</option>
                                        <option value="OK">Oklahoma</option>
                                        <option value="AR">Arkansas</option>
                                        <option value="NM">New Mexico</option>
                                    </select>
                                </div>
                                
                                <!-- DL Expiry -->
                                <div class="form-group">
                                    <label for="add-customer-dl-expiry">Expiration Date <span class="required">*</span></label>
                                    <input type="date" id="add-customer-dl-expiry" required>
                                </div>
                            </div>
                            
                            <!-- Document Uploads -->
                            <div class="form-grid" style="margin-top: 1rem;">
                                <!-- DL Front -->
                                <div class="form-group">
                                    <label for="add-customer-dl-front">DL Front Photo</label>
                                    <div class="file-upload-wrapper">
                                        <input type="file" id="add-customer-dl-front" accept="image/*" onchange="Customers.previewImage(this, 'preview-dl-front')">
                                        <div class="file-upload-placeholder" id="preview-dl-front">
                                            <i class="fas fa-id-card"></i>
                                            <span>Click to upload front</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- DL Back -->
                                <div class="form-group">
                                    <label for="add-customer-dl-back">DL Back Photo</label>
                                    <div class="file-upload-wrapper">
                                        <input type="file" id="add-customer-dl-back" accept="image/*" onchange="Customers.previewImage(this, 'preview-dl-back')">
                                        <div class="file-upload-placeholder" id="preview-dl-back">
                                            <i class="fas fa-id-card"></i>
                                            <span>Click to upload back</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Selfie -->
                                <div class="form-group">
                                    <label for="add-customer-selfie">Selfie Photo</label>
                                    <div class="file-upload-wrapper">
                                        <input type="file" id="add-customer-selfie" accept="image/*" onchange="Customers.previewImage(this, 'preview-selfie')">
                                        <div class="file-upload-placeholder" id="preview-selfie">
                                            <i class="fas fa-camera"></i>
                                            <span>Click to upload selfie</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Corporate Section (hidden by default) -->
                        <div class="form-section" id="add-customer-corporate-section" style="display: none;">
                            <h4 class="section-title"><i class="fas fa-building"></i> Company Information</h4>
                            <div class="form-grid">
                                <!-- Company Name -->
                                <div class="form-group">
                                    <label for="add-customer-company-name">Company Name <span class="required corporate-req">*</span></label>
                                    <input type="text" id="add-customer-company-name" placeholder="ABC Trucking LLC">
                                </div>
                                
                                <!-- Tax ID -->
                                <div class="form-group">
                                    <label for="add-customer-tax-id">Tax ID / EIN</label>
                                    <input type="text" id="add-customer-tax-id" placeholder="XX-XXXXXXX">
                                </div>
                                
                                <!-- Company Phone -->
                                <div class="form-group">
                                    <label for="add-customer-company-phone">Company Phone</label>
                                    <input type="tel" id="add-customer-company-phone" placeholder="(281) 555-5678">
                                </div>
                                
                                <!-- Company Address -->
                                <div class="form-group full-width">
                                    <label for="add-customer-company-address">Company Address</label>
                                    <input type="text" id="add-customer-company-address" placeholder="456 Business Parkway, Houston, TX 77001">
                                </div>
                                
                                <!-- HR Rep Name -->
                                <div class="form-group">
                                    <label for="add-customer-rep-name">HR Rep Name</label>
                                    <input type="text" id="add-customer-rep-name" placeholder="Jane Smith">
                                </div>
                                
                                <!-- HR Rep Email -->
                                <div class="form-group">
                                    <label for="add-customer-rep-email">HR Rep Email</label>
                                    <input type="email" id="add-customer-rep-email" placeholder="hr@company.com">
                                </div>
                                
                                <!-- HR Rep Phone -->
                                <div class="form-group">
                                    <label for="add-customer-rep-phone">HR Rep Phone</label>
                                    <input type="tel" id="add-customer-rep-phone" placeholder="(281) 555-9999">
                                </div>
                            </div>
                        </div>

                        <!-- Payment Preferences -->
                        <div class="form-section">
                            <h4 class="section-title"><i class="fas fa-credit-card"></i> Payment Preferences</h4>
                            <div class="form-grid">
                                <!-- Primary Payment Method -->
                                <div class="form-group">
                                    <label for="add-customer-payment-primary">Primary Payment Method</label>
                                    <select id="add-customer-payment-primary">
                                        <option value="">Select Method</option>
                                        <option value="Zelle" selected>Zelle</option>
                                        <option value="CashApp">CashApp</option>
                                        <option value="Venmo">Venmo</option>
                                        <option value="PayPal">PayPal</option>
                                        <option value="Stripe">Credit Card (Stripe)</option>
                                        <option value="Cash">Cash</option>
                                    </select>
                                </div>
                                
                                <!-- Secondary Payment Method -->
                                <div class="form-group">
                                    <label for="add-customer-payment-secondary">Secondary Payment Method</label>
                                    <select id="add-customer-payment-secondary">
                                        <option value="">Select Method</option>
                                        <option value="Zelle">Zelle</option>
                                        <option value="CashApp" selected>CashApp</option>
                                        <option value="Venmo">Venmo</option>
                                        <option value="PayPal">PayPal</option>
                                        <option value="Stripe">Credit Card (Stripe)</option>
                                        <option value="Cash">Cash</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Emergency Contact -->
                        <div class="form-section">
                            <h4 class="section-title"><i class="fas fa-phone-alt"></i> Emergency Contact</h4>
                            <div class="form-grid">
                                <!-- Emergency Name -->
                                <div class="form-group">
                                    <label for="add-customer-emergency-name">Contact Name</label>
                                    <input type="text" id="add-customer-emergency-name" placeholder="Jane Doe">
                                </div>
                                
                                <!-- Emergency Phone -->
                                <div class="form-group">
                                    <label for="add-customer-emergency-phone">Contact Phone</label>
                                    <input type="tel" id="add-customer-emergency-phone" placeholder="(281) 555-0000">
                                </div>
                                
                                <!-- Relationship -->
                                <div class="form-group">
                                    <label for="add-customer-emergency-relationship">Relationship</label>
                                    <select id="add-customer-emergency-relationship">
                                        <option value="">Select</option>
                                        <option value="Spouse">Spouse</option>
                                        <option value="Parent">Parent</option>
                                        <option value="Sibling">Sibling</option>
                                        <option value="Friend">Friend</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Notes -->
                        <div class="form-section">
                            <div class="form-group full-width">
                                <label for="add-customer-notes">Notes</label>
                                <textarea id="add-customer-notes" rows="3" placeholder="Any additional notes about this customer..."></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="Customers.closeAddModal()">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Add Customer
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ============================================
             EDIT CUSTOMER MODAL
        ============================================ -->
        <div class="modal" id="modal-edit-customer">
            <div class="modal-backdrop" onclick="Customers.closeEditModal()"></div>
            <div class="modal-content modal-lg">
                <div class="modal-header">
                    <h3><i class="fas fa-user-edit"></i> Edit Customer</h3>
                    <button class="modal-close" onclick="Customers.closeEditModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="form-edit-customer" onsubmit="event.preventDefault(); Customers.update();">
                    <input type="hidden" id="edit-customer-id">
                    <div class="modal-body">
                        <div class="form-grid">
                            <!-- Customer ID -->
                            <div class="form-group">
                                <label for="edit-customer-display-id">Customer ID</label>
                                <input type="text" id="edit-customer-display-id" readonly class="readonly">
                            </div>
                            
                            <!-- First Name -->
                            <div class="form-group">
                                <label for="edit-customer-first-name">First Name <span class="required">*</span></label>
                                <input type="text" id="edit-customer-first-name" required>
                            </div>
                            
                            <!-- Last Name -->
                            <div class="form-group">
                                <label for="edit-customer-last-name">Last Name <span class="required">*</span></label>
                                <input type="text" id="edit-customer-last-name" required>
                            </div>
                            
                            <!-- Phone -->
                            <div class="form-group">
                                <label for="edit-customer-phone">Phone <span class="required">*</span></label>
                                <input type="tel" id="edit-customer-phone" required>
                            </div>
                            
                            <!-- Email -->
                            <div class="form-group">
                                <label for="edit-customer-email">Email</label>
                                <input type="email" id="edit-customer-email">
                            </div>
                            
                            <!-- Date of Birth -->
                            <div class="form-group">
                                <label for="edit-customer-dob">Date of Birth</label>
                                <input type="date" id="edit-customer-dob">
                            </div>
                            
                            <!-- Address -->
                            <div class="form-group full-width">
                                <label for="edit-customer-address">Street Address</label>
                                <input type="text" id="edit-customer-address">
                            </div>
                            
                            <!-- City -->
                            <div class="form-group">
                                <label for="edit-customer-city">City</label>
                                <input type="text" id="edit-customer-city">
                            </div>
                            
                            <!-- State -->
                            <div class="form-group">
                                <label for="edit-customer-state">State</label>
                                <input type="text" id="edit-customer-state" maxlength="2" placeholder="TX">
                            </div>
                            
                            <!-- Zip -->
                            <div class="form-group">
                                <label for="edit-customer-zip">ZIP Code</label>
                                <input type="text" id="edit-customer-zip" maxlength="10">
                            </div>
                            
                            <!-- DL Number -->
                            <div class="form-group">
                                <label for="edit-customer-dl-number">Driver's License Number</label>
                                <input type="text" id="edit-customer-dl-number">
                            </div>
                            
                            <!-- DL State -->
                            <div class="form-group">
                                <label for="edit-customer-dl-state">DL State</label>
                                <input type="text" id="edit-customer-dl-state" maxlength="2" placeholder="TX">
                            </div>
                            
                            <!-- DL Expiry -->
                            <div class="form-group">
                                <label for="edit-customer-dl-expiry">DL Expiration</label>
                                <input type="date" id="edit-customer-dl-expiry">
                            </div>
                            
                            <!-- Notes -->
                            <div class="form-group full-width">
                                <label for="edit-customer-notes">Notes</label>
                                <textarea id="edit-customer-notes" rows="3"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="Customers.closeEditModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Update Customer
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ============================================
             IMAGE VIEWER MODAL
        ============================================ -->
        <div class="modal" id="modal-image-viewer">
            <div class="modal-backdrop" onclick="Customers.closeImageModal()"></div>
            <div class="modal-content modal-image-viewer">
                <button class="modal-close" onclick="Customers.closeImageModal()" style="position: absolute; top: 10px; right: 10px; z-index: 10;">
                    <i class="fas fa-times"></i>
                </button>
                <div class="image-viewer-content">
                    <img src="" alt="Document Preview">
                </div>
            </div>
        </div>

        <!-- ============================================
             RENTALS SECTION
        ============================================ -->
        <section id="section-rentals" class="content-section" style="display: none;">
            
            <!-- Rentals Header -->
            <div class="section-header">
                <div class="section-header-left">
                    <h2>Rental Management</h2>
                    <p>Track rentals, approvals, and contracts</p>
                </div>
                <div class="section-header-right">
                    <button class="btn btn-secondary" onclick="Rentals.refresh()">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                    <button class="btn btn-primary" onclick="Rentals.openNewRentalModal()">
                        <i class="fas fa-plus"></i>
                        New Rental
                    </button>
                </div>
            </div>
            
            <!-- Rentals Stats -->
            <div class="mini-stats-grid">
                <div class="mini-stat highlight">
                    <div class="mini-stat-icon amber">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="mini-stat-content">
                        <div class="mini-stat-value" id="rentals-stat-pending">0</div>
                        <div class="mini-stat-label">Pending Approval</div>
                    </div>
                </div>
                <div class="mini-stat">
                    <div class="mini-stat-icon purple">
                        <i class="fas fa-hourglass-half"></i>
                    </div>
                    <div class="mini-stat-content">
                        <div class="mini-stat-value" id="rentals-stat-awaiting">0</div>
                        <div class="mini-stat-label">Awaiting Pickup</div>
                    </div>
                </div>
                <div class="mini-stat">
                    <div class="mini-stat-icon blue">
                        <i class="fas fa-key"></i>
                    </div>
                    <div class="mini-stat-content">
                        <div class="mini-stat-value" id="rentals-stat-active">0</div>
                        <div class="mini-stat-label">Active Rentals</div>
                    </div>
                </div>
                <div class="mini-stat">
                    <div class="mini-stat-icon green">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="mini-stat-content">
                        <div class="mini-stat-value" id="rentals-stat-revenue">$0</div>
                        <div class="mini-stat-label">This Month</div>
                    </div>
                </div>
            </div>
            
            <!-- Rentals Table Card -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-list"></i>
                        All Rentals
                    </h2>
                    <div class="card-filters">
                        <div class="search-input">
                            <i class="fas fa-search"></i>
                            <input type="text" id="rentals-search" placeholder="Search rentals..." oninput="Rentals.filter()">
                        </div>
                        <select id="rentals-status-filter" class="filter-select" onchange="Rentals.filter()">
                            <option value="">All Statuses</option>
                            <option value="pending_approval">Pending Approval</option>
                            <option value="pending_rental">Awaiting Pickup</option>
                            <option value="active">Active</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                </div>
                <div class="card-body no-padding">
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Customer</th>
                                    <th>Vehicle</th>
                                    <th>Status</th>
                                    <th>Dates</th>
                                    <th>Rate</th>
                                    <th>Next Payment</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="rentals-table-body">
                                <tr>
                                    <td colspan="7" class="loading-state">
                                        <i class="fas fa-spinner fa-spin"></i>
                                        <p>Loading rentals...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- ============================================
             VIEW RENTAL MODAL
        ============================================ -->
        <div class="modal" id="modal-view-rental">
            <div class="modal-backdrop" onclick="Rentals.closeViewModal()"></div>
            <div class="modal-content modal-lg">
                <div class="modal-header">
                    <h3><i class="fas fa-file-contract"></i> Rental Details</h3>
                    <button class="modal-close" onclick="Rentals.closeViewModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body" id="view-rental-content">
                    <!-- Content populated by JS -->
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="Rentals.closeViewModal()">Close</button>
                </div>
            </div>
        </div>

        <!-- ============================================
             NEW RENTAL MODAL
        ============================================ -->
        <div class="modal" id="modal-new-rental">
            <div class="modal-backdrop" onclick="Rentals.closeNewRentalModal()"></div>
            <div class="modal-content modal-md">
                <div class="modal-header">
                    <h3><i class="fas fa-plus-circle"></i> Create New Rental</h3>
                    <button class="modal-close" onclick="Rentals.closeNewRentalModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="form-new-rental" onsubmit="event.preventDefault(); Rentals.createRental();">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="new-rental-id">Rental ID</label>
                                <input type="text" id="new-rental-id" readonly class="input-readonly">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="new-rental-customer">Customer <span class="required">*</span></label>
                                <select id="new-rental-customer" required>
                                    <option value="">Select a customer...</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="new-rental-vehicle">Vehicle <span class="required">*</span></label>
                                <select id="new-rental-vehicle" required onchange="Rentals.onVehicleSelect()">
                                    <option value="">Select a vehicle...</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="new-rental-start-date">Start Date <span class="required">*</span></label>
                                <input type="date" id="new-rental-start-date" required>
                            </div>
                            <div class="form-group">
                                <label for="new-rental-start-mileage">Start Mileage <span class="required">*</span></label>
                                <input type="number" id="new-rental-start-mileage" min="0" value="0" placeholder="Current odometer reading">
                            </div>
                        </div>
                        
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="new-rental-weeks">Weeks Contracted</label>
                                <div class="input-with-checkbox">
                                    <input type="number" id="new-rental-weeks" min="1" value="4" oninput="Rentals.calculateNewRentalTotal()">
                                    <label class="checkbox-label ongoing-checkbox">
                                        <input type="checkbox" id="new-rental-ongoing" onchange="Rentals.toggleOngoing()">
                                        <span class="checkmark"></span>
                                        Ongoing
                                    </label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="new-rental-weekly-rate">Weekly Rate ($)</label>
                                <input type="number" id="new-rental-weekly-rate" min="0" step="0.01" value="400" oninput="Rentals.calculateNewRentalTotal()">
                            </div>
                        </div>
                        
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="new-rental-deposit">Deposit ($)</label>
                                <input type="number" id="new-rental-deposit" min="0" step="0.01" value="500" oninput="Rentals.calculateNewRentalTotal()">
                            </div>
                            <div class="form-group">
                                <label for="new-rental-payment-method">Payment Method <span class="required">*</span></label>
                                <select id="new-rental-payment-method" required>
                                    <option value="Zelle">Zelle</option>
                                    <option value="CashApp">CashApp</option>
                                    <option value="Venmo">Venmo</option>
                                    <option value="PayPal">PayPal</option>
                                    <option value="Stripe">Credit/Debit Card (Stripe)</option>
                                    <option value="Cash">Cash</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Amount Due at Pickup</label>
                                <div class="calculated-value" id="new-rental-total">$0</div>
                                <div class="calculated-note" id="new-rental-total-note" style="display: none;"></div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="new-rental-notes">Notes</label>
                                <textarea id="new-rental-notes" rows="2" placeholder="Optional notes..."></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="Rentals.closeNewRentalModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="Rentals.createRental()">
                        <i class="fas fa-check"></i> Create Rental
                    </button>
                </div>
            </div>
        </div>

        <!-- ============================================
             REJECT RENTAL MODAL
        ============================================ -->
        <div class="modal" id="modal-reject-rental">
            <div class="modal-backdrop" onclick="Rentals.closeRejectModal()"></div>
            <div class="modal-content modal-sm">
                <div class="modal-header">
                    <h3><i class="fas fa-times-circle"></i> Reject Rental</h3>
                    <button class="modal-close" onclick="Rentals.closeRejectModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="reject-rental-id">
                    <p class="modal-message">
                        Are you sure you want to reject the rental for <strong id="reject-rental-customer-name"></strong>?
                    </p>
                    <div class="form-group">
                        <label for="reject-rental-reason">Rejection Reason (optional)</label>
                        <textarea id="reject-rental-reason" rows="3" placeholder="Enter reason for rejection..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="Rentals.closeRejectModal()">Cancel</button>
                    <button class="btn btn-danger" onclick="Rentals.submitRejection()">
                        <i class="fas fa-times"></i> Reject Rental
                    </button>
                </div>
            </div>
        </div>

        <!-- ============================================
             START RENTAL MODAL
        ============================================ -->
        <div class="modal" id="modal-start-rental">
            <div class="modal-backdrop" onclick="Rentals.closeStartRentalModal()"></div>
            <div class="modal-content modal-sm">
                <div class="modal-header">
                    <h3><i class="fas fa-play-circle"></i> Start Rental</h3>
                    <button class="modal-close" onclick="Rentals.closeStartRentalModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="start-rental-id">
                    
                    <div class="info-summary">
                        <div class="summary-item">
                            <span class="summary-label">Customer</span>
                            <span class="summary-value" id="start-rental-customer-name">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Vehicle</span>
                            <span class="summary-value" id="start-rental-vehicle-name">-</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="start-rental-date">Start Date <span class="required">*</span></label>
                        <input type="date" id="start-rental-date" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="start-rental-mileage">Starting Mileage</label>
                        <input type="number" id="start-rental-mileage" placeholder="Enter current odometer reading">
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="Rentals.closeStartRentalModal()">Cancel</button>
                    <button class="btn btn-success" onclick="Rentals.submitStartRental()">
                        <i class="fas fa-play"></i> Start Rental
                    </button>
                </div>
            </div>
        </div>

        <!-- ============================================
             RECORD PAYMENT MODAL
        ============================================ -->
        <div class="modal" id="modal-record-payment">
            <div class="modal-backdrop" onclick="Rentals.closeRecordPaymentModal()"></div>
            <div class="modal-content modal-md">
                <div class="modal-header">
                    <h3><i class="fas fa-dollar-sign"></i> Record Payment</h3>
                    <button class="modal-close" onclick="Rentals.closeRecordPaymentModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="payment-rental-id">
                    <input type="hidden" id="payment-customer-id">
                    
                    <div class="info-summary">
                        <div class="summary-item">
                            <span class="summary-label">Customer</span>
                            <span class="summary-value" id="payment-customer-name">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Weekly Rate</span>
                            <span class="summary-value" id="payment-rental-rate">$0</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Outstanding Balance</span>
                            <span class="summary-value highlight" id="payment-balance">$0</span>
                        </div>
                    </div>
                    
                    <div class="form-row two-col">
                        <div class="form-group">
                            <label for="payment-amount">Payment Amount ($) <span class="required">*</span></label>
                            <input type="number" id="payment-amount" min="0" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="payment-date">Payment Date <span class="required">*</span></label>
                            <input type="date" id="payment-date" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="payment-method">Payment Method <span class="required">*</span></label>
                        <select id="payment-method" required>
                            <option value="Zelle">Zelle</option>
                            <option value="CashApp">Cash App</option>
                            <option value="Venmo">Venmo</option>
                            <option value="PayPal">PayPal</option>
                            <option value="Stripe">Credit/Debit Card (Stripe)</option>
                            <option value="Cash">Cash</option>
                            <option value="Check">Check</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="payment-screenshot">Payment Screenshot</label>
                        <input type="file" id="payment-screenshot" accept="image/*" onchange="Rentals.previewPaymentScreenshot()">
                        <div id="payment-screenshot-preview" class="image-preview"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="payment-notes">Notes</label>
                        <textarea id="payment-notes" rows="2" placeholder="Optional payment notes..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="Rentals.closeRecordPaymentModal()">Cancel</button>
                    <button class="btn btn-success" onclick="Rentals.submitPayment()">
                        <i class="fas fa-check"></i> Record Payment
                    </button>
                </div>
            </div>
        </div>

        <!-- ============================================
             END RENTAL MODAL
        ============================================ -->
        <div class="modal" id="modal-end-rental">
            <div class="modal-backdrop" onclick="Rentals.closeEndRentalModal()"></div>
            <div class="modal-content modal-md">
                <div class="modal-header">
                    <h3><i class="fas fa-stop-circle"></i> End Rental</h3>
                    <button class="modal-close" onclick="Rentals.closeEndRentalModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="end-rental-id">
                    
                    <div class="info-summary">
                        <div class="summary-item">
                            <span class="summary-label">Customer</span>
                            <span class="summary-value" id="end-rental-customer-name">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Vehicle</span>
                            <span class="summary-value" id="end-rental-vehicle-name">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Start Mileage</span>
                            <span class="summary-value" id="end-rental-start-mileage">-</span>
                        </div>
                    </div>
                    
                    <div class="form-row two-col">
                        <div class="form-group">
                            <label for="end-rental-date">End Date <span class="required">*</span></label>
                            <input type="date" id="end-rental-date" required>
                        </div>
                        <div class="form-group">
                            <label for="end-rental-mileage">Final Mileage</label>
                            <input type="number" id="end-rental-mileage" placeholder="Current odometer reading">
                        </div>
                    </div>
                    
                    <div class="deposit-summary">
                        <h4><i class="fas fa-calculator"></i> Deposit Calculation</h4>
                        <div class="deposit-row">
                            <span>Original Deposit</span>
                            <span id="end-rental-deposit">$0</span>
                        </div>
                        <div class="deposit-row">
                            <span>Outstanding Balance</span>
                            <span class="text-red" id="end-rental-balance">$0</span>
                        </div>
                        <div class="deposit-row">
                            <label for="end-rental-deductions">Additional Deductions</label>
                            <input type="number" id="end-rental-deductions" min="0" step="0.01" value="0" oninput="Rentals.calculateDepositReturn()">
                        </div>
                        <div class="deposit-row total">
                            <span>Deposit to Return</span>
                            <span class="text-green" id="end-rental-return-amount">$0</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="end-rental-deduction-reason">Deduction Reason</label>
                        <textarea id="end-rental-deduction-reason" rows="2" placeholder="Reason for any deductions (damage, cleaning, etc.)"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="Rentals.closeEndRentalModal()">Cancel</button>
                    <button class="btn btn-warning" onclick="Rentals.submitEndRental()">
                        <i class="fas fa-stop"></i> End Rental
                    </button>
                </div>
            </div>
        </div>

        <!-- ============================================
             PAYMENTS SECTION
        ============================================ -->
        <section id="section-payments" class="content-section" style="display: none;">
            
            <!-- Payments Header -->
            <div class="section-header">
                <div class="section-header-left">
                    <h2>Payment Management</h2>
                    <p>Track and approve customer payments</p>
                </div>
                <div class="section-header-right">
                    <button class="btn-export" onclick="Payments.exportToCSV()">
                        <i class="fas fa-download"></i>
                        Export
                    </button>
                    <button class="btn btn-secondary" onclick="Payments.refresh()">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                    <button class="btn btn-primary" onclick="Payments.openNewPaymentModal()">
                        <i class="fas fa-plus"></i>
                        Record Payment
                    </button>
                </div>
            </div>
            
            <!-- Payments Stats -->
            <div class="mini-stats-grid">
                <div class="mini-stat">
                    <div class="mini-stat-icon green">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="mini-stat-content">
                        <div class="mini-stat-value" id="payments-stat-thismonth">$0</div>
                        <div class="mini-stat-label">This Month</div>
                    </div>
                </div>
                <div class="mini-stat highlight">
                    <div class="mini-stat-icon amber">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="mini-stat-content">
                        <div class="mini-stat-value" id="payments-stat-pending">0</div>
                        <div class="mini-stat-label">Pending Approval</div>
                    </div>
                </div>
                <div class="mini-stat overdue">
                    <div class="mini-stat-icon red">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="mini-stat-content">
                        <div class="mini-stat-value" id="payments-stat-overdue">$0</div>
                        <div class="mini-stat-label">Overdue Fees</div>
                    </div>
                </div>
                <div class="mini-stat">
                    <div class="mini-stat-icon blue">
                        <i class="fas fa-receipt"></i>
                    </div>
                    <div class="mini-stat-content">
                        <div class="mini-stat-value" id="payments-stat-count">0</div>
                        <div class="mini-stat-label">Payments Made</div>
                    </div>
                </div>
            </div>
            
            <!-- Payments Table Card -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-list"></i>
                        All Payments
                    </h2>
                    <div class="card-filters">
                        <div class="search-input">
                            <i class="fas fa-search"></i>
                            <input type="text" id="payments-search" placeholder="Search payments..." oninput="Payments.filter()">
                        </div>
                        <select id="payments-status-filter" class="filter-select" onchange="Payments.filter()">
                            <option value="">All Statuses</option>
                            <option value="pending">Pending</option>
                            <option value="confirmed">Confirmed</option>
                            <option value="failed">Failed</option>
                        </select>
                        <select id="payments-method-filter" class="filter-select" onchange="Payments.filter()">
                            <option value="">All Methods</option>
                            <option value="zelle">Zelle</option>
                            <option value="cashapp">CashApp</option>
                            <option value="venmo">Venmo</option>
                            <option value="paypal">PayPal</option>
                            <option value="stripe">Stripe</option>
                            <option value="cash">Cash</option>
                            <option value="check">Check</option>
                        </select>
                    </div>
                </div>
                <div class="card-body no-padding">
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Customer</th>
                                    <th>Rental</th>
                                    <th>Amount</th>
                                    <th>Method</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="payments-table-body">
                                <tr>
                                    <td colspan="7" class="loading-state">
                                        <i class="fas fa-spinner fa-spin"></i>
                                        <p>Loading payments...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- ============================================
             VIEW PAYMENT MODAL
        ============================================ -->
        <div class="modal" id="modal-view-payment">
            <div class="modal-backdrop" onclick="Payments.closeViewModal()"></div>
            <div class="modal-content modal-lg">
                <div class="modal-header">
                    <h3><i class="fas fa-receipt"></i> Payment Details</h3>
                    <button class="modal-close" onclick="Payments.closeViewModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body" id="view-payment-content">
                    <!-- Content populated by JS -->
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="Payments.closeViewModal()">Close</button>
                </div>
            </div>
        </div>

        <!-- ============================================
             NEW PAYMENT MODAL
        ============================================ -->
        <div class="modal" id="modal-new-payment">
            <div class="modal-backdrop" onclick="Payments.closeNewPaymentModal()"></div>
            <div class="modal-content modal-md">
                <div class="modal-header">
                    <h3><i class="fas fa-plus-circle"></i> Record Payment</h3>
                    <button class="modal-close" onclick="Payments.closeNewPaymentModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="form-new-payment" onsubmit="event.preventDefault(); Payments.createPayment();">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="new-payment-id">Payment ID</label>
                                <input type="text" id="new-payment-id" readonly class="input-readonly">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="new-payment-rental">Rental <span class="required">*</span></label>
                                <select id="new-payment-rental" required onchange="Payments.onRentalSelect()">
                                    <option value="">Select rental...</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Selected rental summary -->
                        <div class="payment-summary">
                            <div class="payment-summary-row">
                                <span class="payment-summary-label">Customer</span>
                                <span class="payment-summary-value" id="new-payment-customer-display">â€”</span>
                            </div>
                            <div class="payment-summary-row">
                                <span class="payment-summary-label">Outstanding Balance</span>
                                <span class="payment-summary-value" id="new-payment-balance-display">â€”</span>
                            </div>
                        </div>
                        
                        <!-- PAYMENT TYPE DROPDOWN - NEW -->
                        <div class="form-row">
                            <div class="form-group">
                                <label for="new-payment-type">Payment Type <span class="required">*</span></label>
                                <select id="new-payment-type" required onchange="Payments.onPaymentTypeChange()">
                                    <option value="">Select type...</option>
                                    <option value="initial">ðŸ Initial (Deposit + First Week)</option>
                                    <option value="weekly" selected>ðŸ“… Weekly Rent</option>
                                    <option value="toll_deposit">ðŸš— Toll Deposit Replenishment</option>
                                    <option value="late_fee">â° Late Fee</option>
                                    <option value="damage_fee">ðŸ§¹ Damage/Cleaning Fee</option>
                                    <option value="other">âœï¸ Other</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="new-payment-amount">Amount ($) <span class="required">*</span></label>
                                <input type="number" id="new-payment-amount" min="0" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label for="new-payment-date">Payment Date <span class="required">*</span></label>
                                <input type="date" id="new-payment-date" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="new-payment-method">Payment Method <span class="required">*</span></label>
                                <select id="new-payment-method" required>
                                    <option value="">Select method...</option>
                                    <option value="Zelle">Zelle</option>
                                    <option value="CashApp">CashApp</option>
                                    <option value="Venmo">Venmo</option>
                                    <option value="PayPal">PayPal</option>
                                    <option value="Stripe">Stripe (Card)</option>
                                    <option value="Cash">Cash</option>
                                    <option value="Check">Check</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="new-payment-screenshot">Payment Screenshot</label>
                                <input type="file" id="new-payment-screenshot" accept="image/*" 
                                       onchange="Payments.onScreenshotSelect(this)">
                                <div id="new-payment-screenshot-preview"></div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="new-payment-notes">Notes</label>
                                <textarea id="new-payment-notes" rows="2" 
                                          placeholder="Optional notes about this payment..."></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="Payments.closeNewPaymentModal()">Cancel</button>
                    <button class="btn btn-success" onclick="Payments.createPayment()">
                        <i class="fas fa-check"></i> Record Payment
                    </button>
                </div>
            </div>
        </div>

        <!-- ============================================
             REJECT PAYMENT MODAL
        ============================================ -->
        <div class="modal" id="modal-reject-payment">
            <div class="modal-backdrop" onclick="Payments.closeRejectModal()"></div>
            <div class="modal-content modal-sm">
                <div class="modal-header">
                    <h3><i class="fas fa-times-circle"></i> Reject Payment</h3>
                    <button class="modal-close" onclick="Payments.closeRejectModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <p class="modal-message">
                        You are about to reject the payment of <strong id="reject-payment-amount">$0</strong> 
                        from <strong id="reject-payment-customer">Customer</strong>.
                    </p>
                    
                    <div class="form-group">
                        <label for="reject-payment-reason">Rejection Reason</label>
                        <textarea id="reject-payment-reason" rows="3" 
                                  placeholder="Optional: Enter reason for rejection..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="Payments.closeRejectModal()">Cancel</button>
                    <button class="btn btn-danger" onclick="Payments.confirmReject()">
                        <i class="fas fa-times"></i> Reject Payment
                    </button>
                </div>
            </div>
        </div>

        <!-- ============================================
             SCREENSHOT FULLSCREEN MODAL
        ============================================ -->
        <div class="modal" id="modal-screenshot">
            <div class="modal-backdrop" onclick="Payments.closeScreenshotModal()"></div>
            <div class="modal-content">
                <button class="modal-close" onclick="Payments.closeScreenshotModal()">
                    <i class="fas fa-times"></i>
                </button>
                <div class="modal-body">
                    <img id="screenshot-fullscreen-img" src="" alt="Payment Screenshot">
                </div>
            </div>
        </div>

        <!-- ============================================
             REPORTS SECTION (Placeholder)
        ============================================ -->
        <section id="section-reports" class="content-section" style="display: none;">
            <!-- Reports content dynamically loaded by reports.js -->
            <div class="reports-loading" style="display: flex; align-items: center; justify-content: center; min-height: 400px;">
                <div style="text-align: center;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 32px; color: var(--accent-green); margin-bottom: 16px;"></i>
                    <p style="color: var(--text-secondary);">Loading reports...</p>
                </div>
            </div>
        </section>

        <!-- ============================================
             SETTINGS SECTION (Placeholder)
        ============================================ -->
        <section id="section-settings" class="content-section" style="display: none;">
            <!-- Business Settings -->
            <div class="settings-grid">
                
                <!-- Profile Card -->
                <div class="card settings-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-user"></i>
                            Profile
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="profile-settings">
                            <div class="profile-avatar-large">
                                <img src="https://ui-avatars.com/api/?name=Adam&background=10b981&color=fff&size=128" alt="Adam">
                                <button class="btn btn-ghost btn-sm avatar-change-btn">
                                    <i class="fas fa-camera"></i>
                                </button>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Full Name</label>
                                <input type="text" class="form-input" value="Adam Landa" id="settings-name">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email Address</label>
                                <input type="email" class="form-input" value="adam@fleetzy.com" id="settings-email">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Phone Number</label>
                                <input type="tel" class="form-input" value="(281) 271-3900" id="settings-phone">
                            </div>
                            <button class="btn btn-primary" onclick="Settings.saveProfile()">
                                <i class="fas fa-save"></i>
                                Save Changes
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Business Info -->
                <div class="card settings-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-building"></i>
                            Business Information
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label class="form-label">Business Name</label>
                            <input type="text" class="form-input" value="Fleetzy Car Rentals" id="settings-business-name">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Business Address</label>
                            <textarea class="form-input" rows="2" id="settings-address">Houston, TX 77001</textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Weekly Rate ($)</label>
                                <input type="number" class="form-input" value="400" id="settings-weekly-rate">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Deposit Amount ($)</label>
                                <input type="number" class="form-input" value="500" id="settings-deposit">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Late Fee (per day)</label>
                            <input type="number" class="form-input" value="50" id="settings-late-fee">
                        </div>
                        <button class="btn btn-primary" onclick="Settings.saveBusiness()">
                            <i class="fas fa-save"></i>
                            Save Changes
                        </button>
                    </div>
                </div>
                
                <!-- Notifications -->
                <div class="card settings-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-bell"></i>
                            Notifications
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="settings-toggle-list">
                            <div class="settings-toggle-item">
                                <div class="toggle-info">
                                    <span class="toggle-label">New Applications</span>
                                    <span class="toggle-description">Get notified when customers apply</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" checked id="notify-applications">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="settings-toggle-item">
                                <div class="toggle-info">
                                    <span class="toggle-label">Payment Received</span>
                                    <span class="toggle-description">Alert when payments are submitted</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" checked id="notify-payments">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="settings-toggle-item">
                                <div class="toggle-info">
                                    <span class="toggle-label">Late Payment Alerts</span>
                                    <span class="toggle-description">Warn about overdue payments</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" checked id="notify-late">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="settings-toggle-item">
                                <div class="toggle-info">
                                    <span class="toggle-label">Maintenance Reminders</span>
                                    <span class="toggle-description">Vehicle service alerts</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" checked id="notify-maintenance">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="settings-toggle-item">
                                <div class="toggle-info">
                                    <span class="toggle-label">Daily Summary Email</span>
                                    <span class="toggle-description">Receive end-of-day reports</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="notify-daily-summary">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Appearance -->
                <div class="card settings-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-palette"></i>
                            Appearance
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label class="form-label">Theme</label>
                            <div class="theme-selector">
                                <button class="theme-option" data-theme="light" onclick="Settings.setTheme('light')">
                                    <i class="fas fa-sun"></i>
                                    <span>Light</span>
                                </button>
                                <button class="theme-option active" data-theme="dark" onclick="Settings.setTheme('dark')">
                                    <i class="fas fa-moon"></i>
                                    <span>Dark</span>
                                </button>
                                <button class="theme-option" data-theme="auto" onclick="Settings.setTheme('auto')">
                                    <i class="fas fa-adjust"></i>
                                    <span>Auto</span>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Accent Color</label>
                            <div class="color-selector">
                                <button class="color-option active" style="--color: #10b981;" data-color="green" title="Emerald Green"></button>
                                <button class="color-option" style="--color: #3b82f6;" data-color="blue" title="Blue"></button>
                                <button class="color-option" style="--color: #8b5cf6;" data-color="purple" title="Purple"></button>
                                <button class="color-option" style="--color: #f59e0b;" data-color="amber" title="Amber"></button>
                                <button class="color-option" style="--color: #ec4899;" data-color="pink" title="Pink"></button>
                            </div>
                        </div>
                        <div class="settings-toggle-item">
                            <div class="toggle-info">
                                <span class="toggle-label">Compact Mode</span>
                                <span class="toggle-description">Smaller fonts and spacing</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="compact-mode">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Integrations -->
                <div class="card settings-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-plug"></i>
                            Integrations
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="integration-list">
                            <div class="integration-item connected">
                                <div class="integration-icon" style="background: linear-gradient(135deg, #3ECF8E, #2CA96D);">
                                    <i class="fas fa-database"></i>
                                </div>
                                <div class="integration-info">
                                    <span class="integration-name">Supabase</span>
                                    <span class="integration-status">Connected</span>
                                </div>
                                <div class="integration-badge success">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                            </div>
                            <div class="integration-item connected">
                                <div class="integration-icon" style="background: linear-gradient(135deg, #FF6B00, #FF4500);">
                                    <i class="fas fa-robot"></i>
                                </div>
                                <div class="integration-info">
                                    <span class="integration-name">n8n Workflows</span>
                                    <span class="integration-status">5 Active Workflows</span>
                                </div>
                                <div class="integration-badge success">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                            </div>
                            <div class="integration-item connected">
                                <div class="integration-icon" style="background: linear-gradient(135deg, #00A6B4, #007B8A);">
                                    <i class="fas fa-comments"></i>
                                </div>
                                <div class="integration-info">
                                    <span class="integration-name">GoHighLevel</span>
                                    <span class="integration-status">SMS & CRM Active</span>
                                </div>
                                <div class="integration-badge success">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                            </div>
                            <div class="integration-item">
                                <div class="integration-icon" style="background: linear-gradient(135deg, #635BFF, #4B47B3);">
                                    <i class="fab fa-stripe-s"></i>
                                </div>
                                <div class="integration-info">
                                    <span class="integration-name">Stripe Payments</span>
                                    <span class="integration-status">Available</span>
                                </div>
                                <button class="btn btn-ghost btn-sm">Connect</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Danger Zone -->
                <div class="card settings-card danger-zone">
                    <div class="card-header">
                        <h3 class="card-title text-danger">
                            <i class="fas fa-exclamation-triangle"></i>
                            Danger Zone
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="danger-item">
                            <div>
                                <strong>Export All Data</strong>
                                <p>Download all your business data as CSV files.</p>
                            </div>
                            <button class="btn btn-outline" onclick="Settings.exportAllData()">
                                <i class="fas fa-download"></i>
                                Export
                            </button>
                        </div>
                        <div class="danger-item">
                            <div>
                                <strong>Clear Cache</strong>
                                <p>Clear local storage and refresh all data.</p>
                            </div>
                            <button class="btn btn-outline" onclick="Settings.clearCache()">
                                <i class="fas fa-broom"></i>
                                Clear
                            </button>
                        </div>
                    </div>
                </div>
                
            </div>
        </section>

    </main>

    <!-- ============================================
         FLOATING ACTION BUTTON WITH MENU
    ============================================ -->
    <div class="fab-container">
        <div class="fab-menu" id="fab-menu">
            <button class="fab-menu-item" onclick="quickAction('addVehicle')" title="Add Vehicle">
                <i class="fas fa-car"></i>
                <span>Add Vehicle</span>
            </button>
            <button class="fab-menu-item" onclick="quickAction('addCustomer')" title="Add Customer">
                <i class="fas fa-user-plus"></i>
                <span>Add Customer</span>
            </button>
            <button class="fab-menu-item" onclick="quickAction('startRental')" title="Start Rental">
                <i class="fas fa-key"></i>
                <span>Start Rental</span>
            </button>
            <button class="fab-menu-item" onclick="quickAction('recordPayment')" title="Record Payment">
                <i class="fas fa-dollar-sign"></i>
                <span>Record Payment</span>
            </button>
        </div>
        <button class="fab" id="fab-main" onclick="toggleFabMenu()" title="Quick Actions">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <!-- ============================================
         NOTIFICATIONS PANEL
    ============================================ -->
    <div class="notifications-panel" id="notifications-panel">
        <div class="notifications-header">
            <h3>Notifications</h3>
            <button class="btn btn-ghost btn-sm" onclick="markAllRead()">Mark all read</button>
        </div>
        <div class="notifications-list" id="notifications-list">
            <!-- Notifications loaded dynamically -->
        </div>
    </div>

    <!-- ============================================
         PROFILE DROPDOWN
    ============================================ -->
    <div class="profile-dropdown" id="profile-dropdown">
        <div class="profile-dropdown-header">
            <img src="https://ui-avatars.com/api/?name=Adam&background=10b981&color=fff&size=64" alt="Adam">
            <div>
                <div class="profile-dropdown-name">Adam Landa</div>
                <div class="profile-dropdown-email"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="15747174785573797070616f6c3b767a78">[email&#160;protected]</a></div>
            </div>
        </div>
        <div class="profile-dropdown-divider"></div>
        <a href="#settings" class="profile-dropdown-item" onclick="Sidebar.navigate('settings'); closeDropdowns();">
            <i class="fas fa-cog"></i>
            <span>Settings</span>
        </a>
        <a href="#" class="profile-dropdown-item" onclick="showKeyboardShortcuts()">
            <i class="fas fa-keyboard"></i>
            <span>Keyboard Shortcuts</span>
        </a>
        <div class="profile-dropdown-divider"></div>
        <a href="#" class="profile-dropdown-item" onclick="Theme.toggle(); closeDropdowns();">
            <i class="fas fa-moon"></i>
            <span>Toggle Dark Mode</span>
        </a>
        <div class="profile-dropdown-divider"></div>
        <a href="https://getfleetzy.netlify.app" target="_blank" class="profile-dropdown-item">
            <i class="fas fa-external-link-alt"></i>
            <span>View Customer Site</span>
        </a>
    </div>

    <!-- ============================================
         KEYBOARD SHORTCUTS MODAL
    ============================================ -->
    <div class="modal-overlay" id="modal-shortcuts">
        <div class="modal modal-md">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-keyboard"></i>
                    Keyboard Shortcuts
                </h3>
                <button class="modal-close" onclick="Utils.closeModal('modal-shortcuts')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="shortcuts-grid">
                    <div class="shortcut-section">
                        <h4>Navigation</h4>
                        <div class="shortcut-item">
                            <span class="shortcut-keys"><kbd>âŒ˜</kbd> + <kbd>K</kbd></span>
                            <span class="shortcut-desc">Focus Search</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-keys"><kbd>G</kbd> then <kbd>D</kbd></span>
                            <span class="shortcut-desc">Go to Dashboard</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-keys"><kbd>G</kbd> then <kbd>V</kbd></span>
                            <span class="shortcut-desc">Go to Vehicles</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-keys"><kbd>G</kbd> then <kbd>C</kbd></span>
                            <span class="shortcut-desc">Go to Customers</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-keys"><kbd>G</kbd> then <kbd>R</kbd></span>
                            <span class="shortcut-desc">Go to Rentals</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-keys"><kbd>G</kbd> then <kbd>P</kbd></span>
                            <span class="shortcut-desc">Go to Payments</span>
                        </div>
                    </div>
                    <div class="shortcut-section">
                        <h4>Quick Actions</h4>
                        <div class="shortcut-item">
                            <span class="shortcut-keys"><kbd>N</kbd></span>
                            <span class="shortcut-desc">New / Add Item</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-keys"><kbd>Esc</kbd></span>
                            <span class="shortcut-desc">Close Modal / Cancel</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-keys"><kbd>?</kbd></span>
                            <span class="shortcut-desc">Show Shortcuts</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================
         TOAST CONTAINER
    ============================================ -->
    <div class="toast-container"></div>

    <!-- ============================================
         SCRIPTS (Load Order Matters!)
    ============================================ -->
    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script src="js/config.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/animations.js"></script>
    <script src="js/sidebar.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/vehicles.js"></script>
    <script src="js/customers.js"></script>
    <script src="js/rentals.js"></script>
    <script src="js/payments.js"></script>
    <script src="js/reports.js"></script>
    <script src="js/documents.js"></script>
    
    <!-- Initialize App -->
    <script>
        // App initialization
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ðŸš— Fleetzy Admin v2.0 Loading...');
            
            // Load dashboard data
            try {
                await Dashboard.load();
                console.log('âœ… Dashboard loaded successfully');
            } catch (error) {
                console.error('âŒ Dashboard load error:', error);
                Utils.toastError('Failed to load dashboard. Please refresh.');
            }
            
            // Load notification badges
            loadNotificationBadges();
            
            // Update theme selector in settings
            updateThemeSelector();
        });

        // ========================================
        // FAB MENU
        // ========================================
        let fabOpen = false;
        
        function toggleFabMenu() {
            fabOpen = !fabOpen;
            const fabMain = document.getElementById('fab-main');
            const fabMenu = document.getElementById('fab-menu');
            
            if (fabOpen) {
                fabMain.classList.add('active');
                fabMenu.classList.add('active');
            } else {
                fabMain.classList.remove('active');
                fabMenu.classList.remove('active');
            }
        }
        
        function quickAction(action) {
            toggleFabMenu(); // Close menu
            
            switch(action) {
                case 'addVehicle':
                    Sidebar.navigate('vehicles');
                    setTimeout(() => Vehicles.openAddModal(), 300);
                    break;
                case 'addCustomer':
                    Sidebar.navigate('customers');
                    setTimeout(() => Customers.openAddModal?.() || Utils.toastInfo('Navigate to add customer'), 300);
                    break;
                case 'startRental':
                    Sidebar.navigate('rentals');
                    setTimeout(() => Rentals.openStartRentalModal?.() || Utils.toastInfo('Use rental actions to start'), 300);
                    break;
                case 'recordPayment':
                    Sidebar.navigate('payments');
                    setTimeout(() => Payments.openRecordModal?.() || Utils.toastInfo('Use payment actions to record'), 300);
                    break;
            }
        }

        // ========================================
        // NOTIFICATIONS
        // ========================================
        let notificationsOpen = false;
        
        function toggleNotifications() {
            notificationsOpen = !notificationsOpen;
            const panel = document.getElementById('notifications-panel');
            
            if (notificationsOpen) {
                loadNotifications();
                panel.classList.add('active');
                closeProfileMenu();
            } else {
                panel.classList.remove('active');
            }
        }
        
        async function loadNotifications() {
            const list = document.getElementById('notifications-list');
            
            // Fetch pending items
            try {
                const [customers, payments] = await Promise.all([
                    db.from('customers').select('*').eq('status', 'pending').limit(5),
                    db.from('payments').select('*, customers(first_name, last_name)').eq('status', 'pending').limit(5)
                ]);
                
                const notifications = [];
                
                // Add pending customers
                (customers.data || []).forEach(c => {
                    notifications.push({
                        icon: 'fa-user-plus',
                        iconClass: 'info',
                        title: 'New Application',
                        message: `${c.first_name} ${c.last_name} applied for rental`,
                        time: Utils.formatDate(c.created_at, 'relative'),
                        action: () => { Sidebar.navigate('customers'); closeDropdowns(); }
                    });
                });
                
                // Add pending payments
                (payments.data || []).forEach(p => {
                    const name = p.customers ? `${p.customers.first_name} ${p.customers.last_name}` : 'Customer';
                    notifications.push({
                        icon: 'fa-dollar-sign',
                        iconClass: 'warning',
                        title: 'Payment Pending',
                        message: `${name} submitted ${Utils.formatCurrency(p.paid_amount)}`,
                        time: Utils.formatDate(p.paid_date, 'relative'),
                        action: () => { Sidebar.navigate('payments'); closeDropdowns(); }
                    });
                });
                
                if (notifications.length === 0) {
                    list.innerHTML = `
                        <div class="notifications-empty">
                            <i class="fas fa-bell-slash"></i>
                            <p>No new notifications</p>
                        </div>
                    `;
                } else {
                    list.innerHTML = notifications.map(n => `
                        <div class="notification-item" onclick="${n.action ? 'this.onclick()' : ''}">
                            <div class="notification-icon ${n.iconClass}">
                                <i class="fas ${n.icon}"></i>
                            </div>
                            <div class="notification-content">
                                <div class="notification-title">${n.title}</div>
                                <div class="notification-message">${n.message}</div>
                                <div class="notification-time">${n.time}</div>
                            </div>
                        </div>
                    `).join('');
                    
                    // Add click handlers
                    list.querySelectorAll('.notification-item').forEach((item, i) => {
                        if (notifications[i].action) {
                            item.onclick = notifications[i].action;
                            item.style.cursor = 'pointer';
                        }
                    });
                }
            } catch (error) {
                console.error('Error loading notifications:', error);
                list.innerHTML = `
                    <div class="notifications-empty">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Failed to load notifications</p>
                    </div>
                `;
            }
        }
        
        function markAllRead() {
            Utils.toastSuccess('All notifications marked as read');
        }
        
        async function loadNotificationBadges() {
            try {
                const [customers, payments] = await Promise.all([
                    db.from('customers').select('id', { count: 'exact' }).eq('status', 'pending'),
                    db.from('payments').select('id', { count: 'exact' }).eq('status', 'pending')
                ]);
                
                const pendingCustomers = customers.count || 0;
                const pendingPayments = payments.count || 0;
                
                Sidebar.updateBadge('customers', pendingCustomers);
                Sidebar.updateBadge('payments', pendingPayments);
                
                // Update bell badge
                const total = pendingCustomers + pendingPayments;
                const bellBadge = document.querySelector('.icon-btn .badge');
                if (bellBadge) {
                    if (total > 0) {
                        bellBadge.textContent = total > 9 ? '9+' : total;
                        bellBadge.style.display = 'flex';
                    } else {
                        bellBadge.style.display = 'none';
                    }
                }
            } catch (error) {
                console.error('Error loading badges:', error);
            }
        }

        // ========================================
        // PROFILE MENU
        // ========================================
        let profileOpen = false;
        
        function toggleProfileMenu() {
            profileOpen = !profileOpen;
            const dropdown = document.getElementById('profile-dropdown');
            
            if (profileOpen) {
                dropdown.classList.add('active');
                closeNotifications();
            } else {
                dropdown.classList.remove('active');
            }
        }
        
        function closeProfileMenu() {
            profileOpen = false;
            document.getElementById('profile-dropdown')?.classList.remove('active');
        }
        
        function closeNotifications() {
            notificationsOpen = false;
            document.getElementById('notifications-panel')?.classList.remove('active');
        }
        
        function closeDropdowns() {
            closeProfileMenu();
            closeNotifications();
            if (fabOpen) toggleFabMenu();
        }
        
        // Close dropdowns when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.profile-btn') && !e.target.closest('.profile-dropdown')) {
                closeProfileMenu();
            }
            if (!e.target.closest('.icon-btn') && !e.target.closest('.notifications-panel')) {
                closeNotifications();
            }
            if (!e.target.closest('.fab-container') && fabOpen) {
                toggleFabMenu();
            }
        });

        // ========================================
        // KEYBOARD SHORTCUTS
        // ========================================
        let pendingKey = null;
        
        function showKeyboardShortcuts() {
            closeDropdowns();
            Utils.openModal('modal-shortcuts');
        }
        
        document.addEventListener('keydown', (e) => {
            // Don't trigger when typing in input
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                if (e.key === 'Escape') {
                    e.target.blur();
                }
                return;
            }
            
            // Cmd/Ctrl + K for search
            if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                e.preventDefault();
                document.getElementById('global-search')?.focus();
                return;
            }
            
            // Escape to close modals
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal-overlay.active').forEach(m => m.classList.remove('active'));
                closeDropdowns();
                document.body.style.overflow = '';
                return;
            }
            
            // ? for shortcuts
            if (e.key === '?') {
                showKeyboardShortcuts();
                return;
            }
            
            // N for new
            if (e.key.toLowerCase() === 'n' && !e.metaKey && !e.ctrlKey) {
                const section = Sidebar.getCurrentSection();
                switch(section) {
                    case 'vehicles': Vehicles.openAddModal(); break;
                    case 'customers': Customers.openAddModal?.(); break;
                }
                return;
            }
            
            // G + key for navigation
            if (pendingKey === 'g') {
                e.preventDefault();
                switch(e.key.toLowerCase()) {
                    case 'd': Sidebar.navigate('dashboard'); break;
                    case 'v': Sidebar.navigate('vehicles'); break;
                    case 'c': Sidebar.navigate('customers'); break;
                    case 'r': Sidebar.navigate('rentals'); break;
                    case 'p': Sidebar.navigate('payments'); break;
                    case 's': Sidebar.navigate('settings'); break;
                }
                pendingKey = null;
                return;
            }
            
            if (e.key.toLowerCase() === 'g') {
                pendingKey = 'g';
                setTimeout(() => { pendingKey = null; }, 1000);
            }
        });

        // ========================================
        // SETTINGS
        // ========================================
        const Settings = {
            load() {
                console.log('âš™ï¸ Loading settings...');
                updateThemeSelector();
            },
            
            saveProfile() {
                Utils.toastSuccess('Profile settings saved!');
            },
            
            saveBusiness() {
                Utils.toastSuccess('Business settings saved!');
            },
            
            setTheme(theme) {
                document.querySelectorAll('.theme-option').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.theme === theme);
                });
                
                if (theme === 'auto') {
                    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    document.body.dataset.theme = prefersDark ? 'dark' : 'light';
                } else {
                    document.body.dataset.theme = theme;
                }
                
                localStorage.setItem('fleetzy-theme', theme);
                Utils.toastSuccess(`Theme set to ${theme}`);
            },
            
            exportAllData() {
                Utils.toastInfo('Exporting all data... This may take a moment.');
                setTimeout(() => {
                    Utils.toastSuccess('Data export complete! Check your downloads.');
                }, 2000);
            },
            
            clearCache() {
                if (confirm('Are you sure you want to clear the cache? This will refresh all data.')) {
                    localStorage.clear();
                    Utils.toastSuccess('Cache cleared! Refreshing...');
                    setTimeout(() => location.reload(), 1000);
                }
            }
        };
        
        window.Settings = Settings;
        
        function updateThemeSelector() {
            const currentTheme = localStorage.getItem('fleetzy-theme') || 'dark';
            document.querySelectorAll('.theme-option').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.theme === currentTheme);
            });
        }

        // ========================================
        // MOBILE MENU
        // ========================================
        let mobileMenuOpen = false;
        
        function toggleMobileMenu() {
            mobileMenuOpen = !mobileMenuOpen;
            const sidebar = document.querySelector('.sidebar');
            let overlay = document.querySelector('.sidebar-overlay');
            
            if (!overlay) {
                overlay = document.createElement('div');
                overlay.className = 'sidebar-overlay';
                overlay.onclick = toggleMobileMenu;
                document.body.appendChild(overlay);
            }
            
            if (mobileMenuOpen) {
                sidebar.classList.add('mobile-open');
                overlay.classList.add('active');
                document.body.style.overflow = 'hidden';
            } else {
                sidebar.classList.remove('mobile-open');
                overlay.classList.remove('active');
                document.body.style.overflow = '';
            }
        }
        
        // Close mobile menu when navigating
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                if (mobileMenuOpen) {
                    toggleMobileMenu();
                }
            });
        });
    </script>

<!-- ============================================
     DOCUMENTS MODALS
============================================ -->

<!-- MANAGE DOCUMENTS MODAL -->
<div class="modal" id="modal-manage-documents">
    <div class="modal-backdrop" onclick="Documents.closeModal()"></div>
    <div class="modal-content modal-lg">
        <div class="modal-header">
            <h3><i class="fas fa-folder-open"></i> Manage Documents</h3>
            <button class="modal-close" onclick="Documents.closeModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <!-- Customer Info -->
            <div class="docs-customer-header">
                <div class="docs-customer-info">
                    <span class="docs-customer-name" id="docs-customer-name">Customer Name</span>
                    <span class="docs-customer-id-label">ID: <span id="docs-customer-id">-</span></span>
                </div>
            </div>
            
            <!-- Upload Section -->
            <div class="docs-upload-section">
                <h4><i class="fas fa-cloud-upload-alt"></i> Upload New Document</h4>
                <div class="docs-upload-form">
                    <div class="form-group">
                        <label for="doc-upload-name">Document Name *</label>
                        <input type="text" id="doc-upload-name" placeholder="e.g., Insurance Card, Payment Receipt">
                    </div>
                    <div class="form-group">
                        <label>File</label>
                        <div class="doc-upload-dropzone" id="doc-upload-preview" onclick="document.getElementById('doc-upload-file').click()">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <span>Click to select file or drag & drop</span>
                            <span class="file-types">Images, PDFs, Documents</span>
                        </div>
                        <input type="file" id="doc-upload-file" style="display: none;" 
                               accept="image/*,.pdf,.doc,.docx,.txt" 
                               onchange="Documents.handleFileSelect(this)">
                    </div>
                    <button type="button" class="btn btn-primary" id="doc-upload-btn" onclick="Documents.upload()">
                        <i class="fas fa-upload"></i> Upload Document
                    </button>
                </div>
            </div>
            
            <!-- Documents List -->
            <div class="docs-list-section">
                <div id="docs-list-container">
                    <div class="docs-loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <span>Loading documents...</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="Documents.closeModal()">Close</button>
        </div>
    </div>
</div>

<!-- DOCUMENT VIEWER MODAL (Lightbox) -->
<div class="modal" id="modal-document-viewer">
    <div class="modal-backdrop" onclick="Documents.closeViewer()"></div>
    <div class="modal-content modal-viewer">
        <button class="viewer-close" onclick="Documents.closeViewer()">
            <i class="fas fa-times"></i>
        </button>
        <div class="viewer-body" id="document-viewer-content">
            <!-- Content injected by JS -->
        </div>
    </div>
</div>
</div>

<div class="modal-overlay" id="modal-add-charge">
    <div class="modal" style="max-width: 500px;">
        <div class="modal-header">
            <h3 class="modal-title">
                <i class="fas fa-plus-circle" style="color: var(--primary);"></i>
                Add Charge
            </h3>
            <button class="modal-close" onclick="Charges.closeAddChargeModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="modal-body">
            <!-- Rental Selection -->
            <div class="form-group">
                <label class="form-label">Select Rental</label>
                <select id="charge-rental-select" class="form-input">
                    <option value="">Loading rentals...</option>
                </select>
            </div>
            
            <!-- Charge Type -->
            <div class="form-group">
                <label class="form-label">Charge Type</label>
                <div class="charge-type-grid">
                    <button type="button" class="charge-type-btn" data-type="toll" onclick="Charges.selectChargeType(this)">
                        <i class="fas fa-road"></i>
                        <span>Toll</span>
                    </button>
                    <button type="button" class="charge-type-btn" data-type="damage" onclick="Charges.selectChargeType(this)">
                        <i class="fas fa-car-crash"></i>
                        <span>Damage</span>
                    </button>
                    <button type="button" class="charge-type-btn" data-type="cleaning" onclick="Charges.selectChargeType(this)">
                        <i class="fas fa-broom"></i>
                        <span>Cleaning</span>
                    </button>
                    <button type="button" class="charge-type-btn" data-type="late_fee" onclick="Charges.selectChargeType(this)">
                        <i class="fas fa-clock"></i>
                        <span>Late Fee</span>
                    </button>
                    <button type="button" class="charge-type-btn" data-type="deposit_replenish" onclick="Charges.selectChargeType(this)">
                        <i class="fas fa-piggy-bank"></i>
                        <span>Deposit</span>
                    </button>
                    <button type="button" class="charge-type-btn" data-type="mileage_overage" onclick="Charges.selectChargeType(this)">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Mileage</span>
                    </button>
                    <button type="button" class="charge-type-btn" data-type="other" onclick="Charges.selectChargeType(this)">
                        <i class="fas fa-file-invoice-dollar"></i>
                        <span>Other</span>
                    </button>
                </div>
            </div>
            
            <!-- Amount -->
            <div class="form-group">
                <label class="form-label">Amount</label>
                <div style="position: relative;">
                    <span style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-tertiary);">$</span>
                    <input type="number" id="charge-amount" class="form-input" style="padding-left: 28px;" 
                           placeholder="0.00" step="0.01" min="0">
                </div>
                <div class="quick-amounts">
                    <button type="button" class="quick-amount-btn" data-amount="5" onclick="document.getElementById('charge-amount').value='5.00'">$5</button>
                    <button type="button" class="quick-amount-btn" data-amount="10" onclick="document.getElementById('charge-amount').value='10.00'">$10</button>
                    <button type="button" class="quick-amount-btn" data-amount="25" onclick="document.getElementById('charge-amount').value='25.00'">$25</button>
                    <button type="button" class="quick-amount-btn" data-amount="50" onclick="document.getElementById('charge-amount').value='50.00'">$50</button>
                    <button type="button" class="quick-amount-btn" data-amount="100" onclick="document.getElementById('charge-amount').value='100.00'">$100</button>
                </div>
            </div>
            
            <!-- Description -->
            <div class="form-group">
                <label class="form-label">Description</label>
                <input type="text" id="charge-description" class="form-input" 
                       placeholder="e.g., Hardy Toll Road - 01/15">
            </div>
            
            <!-- Date -->
            <div class="form-group">
                <label class="form-label">Charge Date</label>
                <input type="date" id="charge-date" class="form-input">
            </div>
            
            <!-- Receipt Upload -->
            <div class="form-group">
                <label class="form-label">Receipt (optional)</label>
                <input type="file" id="charge-receipt" class="form-input" accept="image/*,.pdf">
                <span class="form-hint" style="font-size: 11px; color: var(--text-tertiary);">Upload photo of toll bill, damage, etc.</span>
            </div>
            
            <!-- Notes -->
            <div class="form-group">
                <label class="form-label">Notes (optional)</label>
                <textarea id="charge-notes" class="form-input" rows="2" 
                          placeholder="Any additional notes..."></textarea>
            </div>
        </div>
        
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="Charges.closeAddChargeModal()">
                Cancel
            </button>
            <button class="btn btn-primary" onclick="Charges.submitAddCharge()">
                <i class="fas fa-plus"></i>
                Add Charge
            </button>
        </div>
    </div>
</div>
    <script src="js/charges.js"></script>
    <script src="js/upcoming-payments.js"></script>
</body>
</html>
